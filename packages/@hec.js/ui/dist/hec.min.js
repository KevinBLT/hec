(()=>{var wt=Object.create;var B=Object.defineProperty;var vt=Object.getOwnPropertyDescriptor;var St=Object.getOwnPropertyNames;var At=Object.getPrototypeOf,Nt=Object.prototype.hasOwnProperty;var Et=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var Pt=(t,e)=>{for(var r in e)B(t,r,{get:e[r],enumerable:!0})},Lt=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of St(e))!Nt.call(t,a)&&a!==r&&B(t,a,{get:()=>e[a],enumerable:!(n=vt(e,a))||n.enumerable});return t};var kt=(t,e,r)=>(r=t!=null?wt(At(t)):{},Lt(e||!t||!t.__esModule?B(r,"default",{value:t,enumerable:!0}):r,t));var T={};Pt(T,{activeComponents:()=>y,component:()=>U,componentSelector:()=>v,deletePropsOf:()=>Ot,effect:()=>K,emit:()=>Ft,executeNodeAttributesTemplate:()=>W,expression:()=>R,f:()=>p,hasProp:()=>_,hasProps:()=>I,isSignal:()=>m,memo:()=>Mt,off:()=>Gt,on:()=>Ht,once:()=>Ut,page:()=>Vt,pipes:()=>S,plugins:()=>G,prop:()=>d,propsOf:()=>A,provider:()=>zt,resource:()=>D,resourceBy:()=>Wt,setPropsOf:()=>N,signal:()=>h,templateByName:()=>$t,templateByNode:()=>g,templateByString:()=>qt,useComponent:()=>O,view:()=>_t});function R(t){let e=t.matchAll(/([^ {}\s]+)/g),r={meta:{},text:t,prop:null};for(let n of e)if(n[1].includes("=")){let a=n[1].split("=");r.meta[a[0]]=a[1].replaceAll(/'|"/g,"")}else r.prop=n[1];return r}var S={};var P=new WeakMap,A=t=>P.get(t),Ot=t=>P.delete(t),I=t=>P.has(t),N=(t,e)=>{let r=A(t);r&&typeof r=="object"?P.set(t,Object.assign(r,e)):P.set(t,e)},p=t=>typeof t=="function"?p(t()):t;function d(t,e){let r=e.split(".");if(!e)return t;for(let n of r){if(["state"].includes(n)&&t?.state)return t[n];if(m(t)){let a=t()?.[n];if(m(a)){let o=new AbortController,s=h(a());a.subscribe({next:s},{signal:o.signal});let l=i=>{o.abort(),m(i[n])?(o=new AbortController,i[n].subscribe({next:s},{signal:o.signal}),s(i[n]())):s(i[n])};t.subscribe({next:l}),t=s}else t=t.map(o=>o&&o[n])}else if(typeof t=="function")t=p(t);else if(typeof t[n]<"u")typeof t[n]=="function"&&!m(t[n])?t=t[n].bind(t):t=t[n];else return}return t}function _(t,e){let r=e.split(".");if(!e)return!1;for(let n of r){if(["loading","error"].includes(n)&&t?.loading&&t?.error)return t[n];if(typeof t=="function")t=p(t);else if(typeof t[n]<"u")t=t[n];else return!1}return!0}var J={items:new Map,setItem(t,e){this.items.set(t,e?.toString())},get length(){return this.items.keys().length},key(t){return Array.from(this.items.values()).at(t)},clear(){this.items.clear()},getItem(t){return this.items.get(t)},removeItem(t){this.items.delete(t)}},L=new Map;function Ct(t){try{let e=window[t+"Storage"];return typeof e.length=="number"?e:J}catch{return J}}window.addEventListener("storage",t=>{if(!L.has(t.key))return;let e=L.get(t.key),r=t.storageArea.getItem(t.key);typeof r=="string"&&r!=="undefined"&&e.update(JSON.parse(r))});function h(t=null,e={}){if(e.id&&L.has(e.id))return L.get(e.id);let r=[],n=e.storage&&Ct(e.storage),a=i=>{t=i,n&&n.setItem(e.id,JSON.stringify(t));for(let c of r)c.next(t)};function o(){return arguments.length&&t!==arguments[0]&&a(arguments[0]),t}let s=(i,c=null)=>{r.push(i),c?.signal.addEventListener("abort",()=>{let u=r.indexOf(i);u>-1&&r.splice(u,1)},{once:!0})};if(n){let i=n.getItem(e.id);a(typeof i=="string"&&i!=="undefined"?JSON.parse(i):t)}let l=Object.assign(o,{id:e.id,storage:e.storage,toString:()=>t?.toString(),set:i=>t=i,update:a,subscribe:s,map:i=>{let c=h(i(t)),u=new AbortController,b=c.subscribe;return s({next:f=>c(i(f))},{signal:u.signal}),Object.assign(c,{set:()=>null,subscribe:(f,w)=>{b(f,w),w?.signal.addEventListener("abort",()=>u.abort())}})},filter:i=>{let c=h(i(t)?t:null);return s({next:u=>i(u)?c(u):null}),Object.assign(c,{set:()=>null})}});return e.id&&L.set(e.id,l),l}function K(t,e=[],r=null){for(let n of e)n.subscribe({next:()=>r=t(r)});return t(r)}function Mt(t,e=[],r=null){let n=h(null);return n(K(a=>n(t(a)),e,r)),n}function D(t,e=null){let r=h(e),n=h("loaded"),a=async()=>{if(n()!="pending"){try{n("pending"),r(await t()),n("loaded"),delete r.error}catch(o){n("error"),r.error=o}return r()}};return a(),Object.assign(r,{state:n,refetch:a})}function Wt(t,e,r=null){let n=D(()=>e(p(t)),r);return m(t)&&t.subscribe({next:()=>n.refetch()}),n}function m(t){return t&&t.subscribe}function zt(t,e=[]){function r(){let n=h(null),a=null,o=s=>{a=s,n(t(s))};for(let s of e)s.subscribe({next:()=>n(t(a))});return Object.assign({provide:o},n)}return r}var Tt=h({}),$=h(location.pathname),X=window.history.pushState,jt=window.history.replaceState,V={updateQueued:!1},q=[],Z=new WeakMap;function Bt(t,e){let r=Array.from(t.path.matchAll(/\:/g)).length*25,n=Array.from(e.path.matchAll(/\:/g)).length*25;return r+=Array.from(t.path.matchAll(/\*/g)).length*150,n+=Array.from(e.path.matchAll(/\*/g)).length*150,r-n}function Y(t){let e=t.node,r=t.path,n=e.parentElement?.closest("[data-route]"),a=Z.get(n),o=a?.pattern?.pathname,s=a?.group??q;t.group=[],Z.set(e,t),o&&(r=r=="/"?"":r,r=o.replaceAll(/[^\/a-zA-Z0-9]+$/gm,"")+r.replaceAll(/^[^\/a-zA-Z0-9]+/gm,"")),r=r.replaceAll(/\/+/g,"/").replace(/\/$/m,""),t.pattern=new URLPattern({pathname:r||"/"}),s.push(t),s.sort(Bt),V.updateQueued||(V.updateQueued=!0,queueMicrotask(E))}var C=document.querySelector('head meta[name="route"]')||document.createElement("meta");C.name="route";C.content=location.pathname;document.head.append(C);var E=()=>{let t=location.href.replace(/index\.*[a-z0-9]*$/gm,"");$(t),Tt(Object.fromEntries(new URLSearchParams(location.search)));let e=!1,r=n=>{let a=!1;for(let o of n){let s=o.pattern.test(t);o.update(!a&&s),!a&&s&&(a=!0,o.group.length?r(o.group):(e=!0,C.content=o.pattern.pathname))}return e};return V.updateQueued=!1,r(q)},Rt=t=>{let e=t.target.closest("a")?.href,r=new URL(e,location.href);e&&r.hostname==location.hostname&&q.some(n=>n.pattern.test(e))&&(X.call(window.history,null,null,e),E()&&t.preventDefault())};window.addEventListener("popstate",E);window.addEventListener("hashchange",E);window.addEventListener("click",Rt);window.history.pushState=function(e,r,n){X.call(window.history,e,r,n),E()};window.history.replaceState=function(e,r,n){jt.call(window.history,e,r,n),E()};var F=new WeakMap,It=new MutationObserver(t=>{for(let e of t)F.has(e.target)&&F.get(e.target)()}),tt={select:"[data-match]",run:t=>{let e=t.dataset.match,r=o=>o.replace(/index\.*[a-z0-9]*$/gm,"");function n(){return r(new URL(t.dataset.route||t.getAttribute("href"),location.href).pathname)}let a=()=>{n()==r(location.pathname)?t.classList.add(e):t.classList.remove(e)};$.subscribe({next:a}),F.set(t,a),It.observe(t,{attributes:!0,attributeFilter:["href","data-route"]}),a(),t.removeAttribute("data-match")}};var et={number:t=>t.valueAsNumber,date:t=>t.valueAsDate,text:t=>t.value,checkbox:t=>t.checked,"":t=>t.value},rt={select:"[data-bind],[name]",run:(t,e)=>{let r=t.dataset.bind||t.getAttribute("name"),n=d(e,r);if(n){let a=o=>{t.type=="checkbox"?t.checked=o:t.value=o};a(p(n)),m(n)&&(n.subscribe({next:a}),t.addEventListener("input",()=>n(et[t.type]?.(t)??t.value)),t.addEventListener("change",()=>n(et[t.type]?.(t)??t.value)))}}};var k=new WeakMap,nt=new IntersectionObserver(t=>{for(let e of t)if(e.isIntersecting&&k.has(e.target)){for(let r of k.get(e.target))r();k.delete(e.target),nt.unobserve(e.target)}},{rootMargin:"256px"});function x(t){return new Promise(e=>{let r=k.get(t)??[];r.push(e),k.set(t,r),nt.observe(t)})}var M=new WeakSet,at={select:"[data-include]",run:(t,e)=>{if(M.has(t)||t.children.length)return;M.add(t);let r=t.hasAttribute("data-lazy")&&t.closest("[hidden]"),n=async()=>{t.dispatchEvent(new CustomEvent("::load",{bubbles:!0}));let a=await fetch(t.dataset.include,{headers:{accept:"text/html,text/*"}});if(a.ok){let o=await a.text();t.dispatchEvent(new CustomEvent("::loaded",{bubbles:!0})),t.innerHTML=o;for(let s of t.childNodes)g(s,e);t.removeAttribute("data-include"),t.removeAttribute("data-lazy")}};t.hasAttribute("data-lazy")?x(t).then(n):n()}};var ot=new WeakSet,st={select:"[data-for]",run:(t,e,r)=>{if(ot.has(t))return;let n=t.dataset.for.replace("let","").split("of"),a=n[0].split(","),o=n.at(-1).trim(),s=a[0].trim()==o?"__e":a[0].trim(),l=a[1]?.trim()??"__i",i=d(e,o),c=document.createComment(t.dataset.for);t.replaceWith(c),M.add(t);let u=()=>{let f=c;for(;(f=f.nextSibling)&&((f instanceof HTMLElement||f instanceof SVGElement)&&f.dataset.for==t.dataset.for);)f=f.previousSibling,f.nextSibling.remove()},b=f=>{if(u(),!f||!f[Symbol.iterator])return console.warn("data-for: The value given is not iterable.",{key:o,value:f});for(let w=0,j=c;w<f.length;w++){let Q=t.cloneNode(!0),yt=Object.assign({},e,{[s]:f[w],[l]:w});ot.add(Q),j.after(g(Q,yt)),j=j.nextSibling}};b(p(i)),m(i)&&i.subscribe({next:b}),r()}};var it={select:"[data-if], [data-if-not]",run:(t,e)=>{let r=d(e,t.dataset.if||t.dataset.ifNot),n=document.createComment("if: "+(t.dataset.if||t.dataset.ifNot)),a=!!t.dataset.ifNot;t.replaceWith(n);let o=s=>{s=a?!s:s,!t.parentNode&&s?(t.hidden=!1,n.after(t)):t.localName!="link"&&t.remove()};o(p(r)),m(r)&&r.subscribe({next:o})}};var lt=new WeakSet,ct={select:"[data-lazy]",run:(t,e,r)=>{if(lt.has(t)||!t.childNodes.length)return;lt.add(t);let n=t.dataset.lazy,a=()=>{t.removeAttribute("data-lazy"),W(t,e);for(let o of t.childNodes)g(o,e)};n&&(t.addEventListener("::load",()=>t.classList.add(n),{once:!0}),t.addEventListener("::loaded",()=>t.classList.remove(n),{once:!0})),x(t).then(a),r()}};var ut={select:"[data-on]",run:(t,e)=>{let r=n=>{let a=n.split(":"),o=a[0].trim(),s=a.at(-1).trim(),l=d(e,s);l&&t.addEventListener(o,l)};for(let n of t.dataset.on.split(","))r(n)}};var ft=t=>{let e=document.createElement("link");Object.assign(e,t),e.rel="preload",document.head.append(e)};var mt=new WeakSet,pt={select:"[data-preload]",run:t=>{if(mt.has(t)||t.hidden)return;mt.add(t);let e=()=>{let r=t.dataset.preload.split(",");for(let n of r){let a=n.split(":");ft({href:a[0],as:a[1]??"fetch"})}};t.hasAttribute("data-lazy")?x(t).then(e):e()}};var dt={select:"[data-route], [data-route-not]",run:async t=>{"URLPattern"in window||await import("https://kevinblt.github.io/hec/packages/@hec.js/ui/dist/urlpattnern.min.js");let e=t.dataset.route,r=document.createComment("route: "+e);Y({path:e,update:a=>{if(a){if(t.hidden=!1,t.parentNode)return;r.after(t)}else t.localName!="link"&&t.remove()},node:t}),t.replaceWith(r)}};var v="[data-component], [data-view], [data-page]";new MutationObserver(t=>{for(let e of t){for(let r of e.addedNodes){let n=r instanceof HTMLElement||r instanceof SVGElement;n&&!y.has(r)&&r.matches(v)?O(r,r.dataset.component??r.dataset.view??r.dataset.page):n&&y.has(r)&&r.dispatchEvent(new CustomEvent("::mount"))}for(let r of e.removedNodes)y.has(r)&&r.dispatchEvent(new CustomEvent("::unmount"))}}).observe(document,{childList:!0,subtree:!0});var z={},y=new WeakMap;function O(t,e){z[e]&&(z[e].use(t),y.set(t,z[e].component))}var H=class{constructor(e){Object.assign(this,e)}signals;node;props;#t=!1;#e=null;on(e,r,n=null){this.node.addEventListener(e,r,n)}emit(e,r=null,n=!1){this.node.dispatchEvent(new CustomEvent(e,{detail:r,bubbles:n}))}async insert(e){if(this.#e??=this.node.hasAttribute("data-lazy"),this.#e&&!this.#t)this.#t=!0,this.emit("::load",null,!0),this.node.removeAttribute("data-lazy"),await x(this.node);else{if(this.#t)return this.emit("::mount");await Promise.resolve(),this.emit("::load",null,!0),this.#t=!0}let r=e(this.signals,this);(a=>{N(this,A(a));let o=a instanceof Element&&a.querySelector("slot");if(o){let s=document.createComment("children");o.before(s),o.replaceWith(...this.node.childNodes)}this.node.append(a),this.emit("::loaded",null,!0);for(let s in this.props){let l=this.node.getAttribute(s)??"";this.node.hasAttribute(s)||this.node.setAttribute(s,this.props[s]?.toString()),l.startsWith("@")||this.signals[s].subscribe({next:i=>i==null?this.node.removeAttribute(s):this.node.setAttribute(s,i.toString())})}this.node.dispatchEvent(new CustomEvent("::mount"))})(r instanceof Promise?await r:r)}propSignalByLowerKey(e=""){e=e.toLowerCase();for(let r in this.signals)if(r.toLowerCase()==e)return[this.props[r],this.signals[r]];return[null,null]}attributeChange(e,r,n){let[a,o]=this.propSignalByLowerKey(e);if(n?.startsWith("@")){let s=this.node.parentNode,l=n.slice(1),i=d(A(s),l)??d(A(this.node),l);m(i)?this.signals[e]=i:o(i)}else o(typeof a=="number"?parseFloat(n):n)}};function U(t,e,r){z[t]??={observer:new MutationObserver(a=>{for(let o of a)o.target instanceof Element&&y.get(o.target)?.attributeChange(o.attributeName,o.oldValue,o.target.getAttribute(o.attributeName))}),component:null,use(a){this.component=new H({signals:Object.fromEntries(Object.entries(e).map(o=>[o[0],h(o[1])])),props:e,node:a}),this.component.insert(r),this.observer.observe(a,{attributes:!0,attributeOldValue:!0,attributeFilter:Object.keys(e).map(o=>o.toLowerCase())})}};let n=v.replaceAll("]",`="${t}"]`);for(let a of document.querySelectorAll(n))O(a,t)}var _t=U,Vt=U;var ht={select:v,run:t=>{y.has(t)||O(t,t.dataset.component??t.dataset.view??t.dataset.page)}};var G=[ht,st,it,dt,pt,at,ut,rt,tt,ct];var gt={};function $t(t,e={}){t instanceof URL&&(t=t.host==location.host?t.pathname:t.toString());let r=document.querySelector(`template[name="${t}"]`);if(!r){let n=document.querySelector('head meta[name="template-path"]');return gt[t]??=new Promise(async a=>{r=document.createElement("template"),r.setAttribute("id",t.toString()),r.innerHTML=await fetch(n?.content?.replaceAll("[name]",t.toString())??t).then(o=>o.text()),document.body.append(r),a(r)}),gt[t].then(a=>g(a.content.cloneNode(!0),e))}return g(r.content.cloneNode(!0),e)}function qt(t,e={}){let r=document.createElement("template");return r.dataset.name="anonymous",r.innerHTML=t,g(r.content.cloneNode(!0),e)}function g(t,e={}){let r=(n,a=new WeakSet)=>{let o=!1;if(!(I(n)||a.has(n))){if(n.nodeName=="#document-fragment"&&N(n,e),n instanceof HTMLElement||n instanceof SVGElement){N(n,e);for(let s of G)n.matches(s.select)&&s.run(n,e,()=>o=!0);if(o)return;W(n,e)}else if(n instanceof Text&&n.textContent.includes("{{")){let s=n.textContent.split(/{{|}}/g);for(let l=0,i=n,c;l<s.length;l++)c=document.createTextNode(s[l]),l%2!=0&&bt(`{{${s[l]}}}`,e,u=>c.data=u),a.add(c),i.after(c),i=c;n.remove()}a.add(n);for(let s of n.childNodes)r(s,a)}};return r(t,new WeakSet),t}var W=(t,e)=>{let r=t.getAttributeNames();for(let n of r){let a=t.getAttribute(n);a?.includes("{{")?bt(a,e,o=>{o=o.trim().replace(/ +/," "),o==="undefined"||o==="null"?t.removeAttribute(n):t.setAttribute(n,o)}):t.matches(v)&&_(e,a)&&t.setAttribute(n,`@${a}`)}},bt=(t,e,r)=>{let n=t.match(/{{[^}]+}}/g).map(R),a=t,o=()=>{t=a;for(let s of n)t=t.replace(s.text,p(s.value));return t};for(let s of n){let l=null;if(s.prop[s.prop.length-1]===")"){let i=s.prop.split("("),c=d(e,i[1].substring(0,i[1].length-1).trim()),u=i[0].trim();l=d(e,u),l=l(),l.provide(p(c)),m(c)&&c.subscribe({next:b=>l.resolve(p(b))})}else l=d(e,s.prop);if(l==null&&console.warn(`{{ ${s.prop} }}: No value for this key`,{key:s.prop,value:l}),m(l)){let i=l;for(let c in s.meta)if(S[c]){let u=S[c];i=i.map(b=>u({value:b,key:s.prop,param:s.meta[c],options:s.meta}))}s.value=i,i.subscribe({next:()=>r(o())})}else{let i=l;for(let c in s.meta)if(S[c]){let u=S[c];i=u({value:p(l),key:s.prop,param:s.meta[c],options:s.meta})}s.value=()=>i}}r(o())};var xt=new WeakMap;function Ft(t,e=null){document.dispatchEvent(new CustomEvent(t,{detail:e}))}function Ht(t,e){let r=n=>e(n.detail);xt.set(e,r),document.addEventListener(t,r)}function Ut(t){return new Promise(e=>{let r=n=>e(n.detail);document.addEventListener(t,r,{once:!0})})}function Gt(t,e){document.removeEventListener(t,xt.get(e))}for(let t in T)globalThis[t]=T[t];})();
