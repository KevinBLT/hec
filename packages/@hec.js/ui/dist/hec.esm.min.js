function j(t){let e=t.matchAll(/([^ {}\s]+)/g),a={meta:{},text:t,prop:null};for(let r of e)if(r[1].includes("=")){let n=r[1].split("=");a.meta[n[0]]=n[1].replaceAll(/'|"/g,"")}else a.prop=r[1];return a}var S={};var E=new WeakMap,k=t=>E.get(t),z=t=>E.delete(t),B=t=>E.has(t),L=(t,e)=>{let a=k(t);a&&typeof a=="object"?E.set(t,Object.assign(a,e)):E.set(t,e)},d=t=>typeof t=="function"?d(t()):t;function h(t,e){let a=e.split(".");if(!e)return t;for(let r of a){if(["loading","error"].includes(r)&&t?.loading&&t?.error)return t[r];if(m(t)){let n=t()?.[r];if(m(n)){let o=new AbortController,c=b(n());n.subscribe({next:c},{signal:o.signal});let l=s=>{o.abort(),m(s[r])?(o=new AbortController,s[r].subscribe({next:c},{signal:o.signal}),c(s[r]())):c(s[r])};t.subscribe({next:l}),t=c}else t=t.map(o=>o&&o[r])}else if(typeof t=="function")t=d(t);else if(typeof t[r]<"u")typeof t[r]=="function"&&!m(t[r])?t=t[r].bind(t):t=t[r];else return}return t}function I(t,e){let a=e.split(".");if(!e)return!1;for(let r of a){if(["loading","error"].includes(r)&&t?.loading&&t?.error)return t[r];if(typeof t=="function")t=d(t);else if(typeof t[r]<"u")t=t[r];else return!1}return!0}var R={items:new Map,setItem(t,e){this.items.set(t,e.toString())},get length(){return this.items.keys().length},key(t){return Array.from(this.items.values()).at(t)},clear(){this.items.clear()},getItem(t){return this.items.get(t)},removeItem(t){this.items.delete(t)}},P=new Map;function nt(t){try{let e=window[t+"Storage"];return typeof e.length=="number"?e:R}catch{return R}}window.addEventListener("storage",t=>{if(!P.has(t.key))return;let e=P.get(t.key),a=t.storageArea.getItem(t.key);typeof a=="string"&&a!=="undefined"&&e.update(JSON.parse(a))});function b(t=null,e={}){if(e.id&&P.has(e.id))return P.get(e.id);let a=[],r=e.storage&&nt(e.storage),n=s=>{t=s,r&&r.setItem(e.id,JSON.stringify(t));for(let i of a)i.next(t)};function o(){return arguments.length&&t!==arguments[0]&&n(arguments[0]),t}let c=(s,i=null)=>{a.push(s),i?.signal.addEventListener("abort",()=>{let u=a.indexOf(s);u>-1&&a.splice(u,1)},{once:!0})};if(r){let s=r.getItem(e.id);n(typeof s=="string"&&s!=="undefined"?JSON.parse(s):t)}let l=Object.assign(o,{id:e.id,storage:e.storage,toString:()=>t.toString(),set:s=>t=s,update:n,subscribe:c,map:s=>{let i=b(s(t)),u=new AbortController,p=i.subscribe;return c({next:f=>i(s(f))},{signal:u.signal}),Object.assign(i,{set:()=>null,subscribe:(f,g)=>{p(f,g),g?.signal.addEventListener("abort",()=>u.abort())}})},filter:s=>{let i=b(s(t)?t:null);return c({next:u=>s(u)?i(u):null}),Object.assign(i,{set:()=>null})}});return e.id&&P.set(e.id,l),l}function at(t,e=[],a=null){for(let r of e)r.subscribe({next:()=>a=t(a)});return t(a)}function bt(t,e=[],a=null){let r=b(null);return r(at(n=>r(t(n)),e,a)),r}function st(t,e=null){let a=b(e),r=b(!0),n=b(null),o=async()=>{try{a(await t()),r(!1)}catch(c){c(c)}return a()};return o(),Object.assign(a,{loading:r,error:n,refetch:o})}function gt(t,e,a=null){let r=st(()=>e(d(t)),a);return m(t)&&t.subscribe({next:()=>r.refetch()}),r}var m=t=>t&&t.subscribe;var ot=b({}),A=b(location.pathname);var y=document.querySelector('head meta[name="route"]');y||(y=document.createElement("meta"),y.name="route",y.content=location.pathname,document.head.append(y));var C=()=>{y.content="",A(location.pathname),ot(Object.fromEntries(new URLSearchParams(location.search))),y.content=y.content||location.pathname};window.addEventListener("popstate",C);window.addEventListener("hashchange",C);var it=window.history.pushState,ct=window.history.replaceState;window.history.pushState=function(e,a,r){it.call(window.history,e,a,r),C()};window.history.replaceState=function(e,a,r){ct.call(window.history,e,a,r),C()};var M=new WeakMap,lt=new MutationObserver(t=>{for(let e of t)M.has(e.target)&&M.get(e.target)()}),T={select:"[data-match]",run:t=>{let e=t.dataset.match,a=o=>o.replace(/index\.*[a-z0-9]*$/gm,"");function r(){return a(new URL(t.dataset.route||t.getAttribute("href"),location.href).pathname)}let n=()=>{r()==a(location.pathname)?t.classList.add(e):t.classList.remove(e)};A.subscribe({next:n}),M.set(t,n),lt.observe(t,{attributes:!0,attributeFilter:["href","data-route"]}),n(),t.removeAttribute("data-match")}};var q={number:t=>t.valueAsNumber,date:t=>t.valueAsDate,text:t=>t.value,checkbox:t=>t.checked,"":t=>t.value},H={select:"[data-bind],[name]",run:(t,e)=>{let a=t.getAttribute("name")||t.dataset.bind,r=h(e,a);if(r){let n=o=>{t.type=="checkbox"?t.checked=o:t.value=o};n(d(r)),m(r)&&(r.subscribe({next:n}),t.addEventListener("input",()=>r(q[t.type]?.(t)??t.value)),t.addEventListener("change",()=>r(q[t.type]?.(t)??t.value)))}}};var N=new WeakMap,_=new IntersectionObserver(t=>{for(let e of t)if(e.isIntersecting&&N.has(e.target)){for(let a of N.get(e.target))a();N.delete(e.target),_.unobserve(e.target)}},{rootMargin:"256px"});function w(t){return new Promise(e=>{let a=N.get(t)??[];a.push(e),N.set(t,a),_.observe(t)})}var O=new WeakSet,U={select:"[data-include]",run:(t,e)=>{if(O.has(t)||t.children.length)return;O.add(t);let a=t.hasAttribute("data-lazy")&&t.closest("[hidden]"),r=async()=>{t.dispatchEvent(new CustomEvent("::load",{bubbles:!0}));let n=await fetch(t.dataset.include,{headers:{accept:"text/html,text/*"}});if(n.ok){let o=await n.text();t.dispatchEvent(new CustomEvent("::loaded",{bubbles:!0})),t.innerHTML=o;for(let c of t.childNodes)x(c,e);t.removeAttribute("data-include"),t.removeAttribute("data-lazy")}};t.hasAttribute("data-lazy")?w(t).then(r):r()}};var $=new WeakSet,F={select:"[data-for]",run:(t,e,a)=>{if($.has(t))return;let r=t.dataset.for.replace("let","").split("of"),n=r[0].split(","),o=r.at(-1).trim(),c=n[0].trim()==o?"__e":n[0].trim(),l=n[1]?.trim()??"__i",s=h(e,o),i=document.createComment(t.dataset.for);t.replaceWith(i),O.add(t);let u=()=>{let f=i;for(;(f=f.nextSibling)&&(f instanceof HTMLElement&&f.dataset.for==t.dataset.for);)f=f.previousSibling,f.nextSibling.remove()},p=f=>{if(u(),!f||!f[Symbol.iterator])return console.warn("data-for: The value given is not iterable.",{key:o,value:f});for(let g=0,v=i;g<f.length;g++){let W=t.cloneNode(!0),rt=Object.assign({},e,{[c]:f[g],[l]:g});$.add(W),v.after(x(W,rt)),v=v.nextSibling}};p(d(s)),m(s)&&s.subscribe({next:p}),a()}};var V={select:"[data-if]",run:(t,e)=>{let a=h(e,t.dataset.if),r=document.createComment("if: "+t.dataset.if);t.replaceWith(r);let n=o=>{!t.parentNode&&o?(t.hidden=!1,r.after(t)):t.localName!="link"&&t.remove()};n(d(a)),m(a)&&a.subscribe({next:n})}};var J=new WeakSet,D={select:"[data-lazy]",run:(t,e,a)=>{if(J.has(t)||!t.childNodes.length)return;J.add(t);let r=t.dataset.lazy,n=()=>{x(t,e);for(let o of t.childNodes)x(o,e);t.removeAttribute("data-lazy")};r&&(t.addEventListener("::load",()=>t.classList.add(r),{once:!0}),t.addEventListener("::loaded",()=>t.classList.remove(r),{once:!0})),w(t).then(n),a()}};var K={select:"[data-on]",run:(t,e)=>{let a=r=>{let n=r.split(":"),o=n[0].trim(),c=n.at(-1).trim(),l=h(e,c);l&&t.addEventListener(o,l)};for(let r of t.dataset.on.split(","))a(r)}};var G=t=>{let e=document.createElement("link");Object.assign(e,t),e.rel="preload",document.head.append(e)};var Q=new WeakSet,X={select:"[data-preload]",run:t=>{if(Q.has(t)||t.hidden)return;Q.add(t);let e=()=>{let a=t.dataset.preload.split(",");for(let r of a){let n=r.split(":");G({href:n[0],as:n[1]??"fetch"})}};t.hasAttribute("data-lazy")?w(t).then(e):e()}};var ut=t=>{let e=t.dataset.route;for(;t=t.parentElement;)t.dataset.route&&(e=t.dataset.route+e);return e.replaceAll(/\/+/g,"/")},Y={select:"[data-route]",run:async t=>{"URLPattern"in window||await import("https://kevinblt.github.io/hec/packages/@hec.js/ui/dist/urlpattnern.min.js");let e=ut(t),a=new URLPattern({pathname:e}),r=document.createComment("route: "+e);t.replaceWith(r);let n=()=>{let o=location.href.replace(/index\.*[a-z0-9]*$/gm,"");if(!t.parentNode&&a.test(o)){t.hidden=!1,r.after(t);let c=document.querySelector('head meta[name="route"]');c&&(c.content=a.pathname)}else t.localName!="link"&&t.remove()};A.subscribe({next:n}),n()}};var Z=[F,V,Y,X,U,K,H,T,D];var tt={};function ue(t,e={}){t instanceof URL&&(t=t.host==location.host?t.pathname:t.toString());let a=document.querySelector(`template[name="${t}"]`);if(!a){let r=document.querySelector('head meta[name="template-path"]');return tt[t]??=new Promise(async n=>{a=document.createElement("template"),a.setAttribute("id",t.toString()),a.innerHTML=await fetch(r?.content?.replaceAll("[name]",t.toString())??t).then(l=>l.text());let o=a.content.querySelectorAll('link[rel="stylesheet"][href]'),c=[];for(let l of o)c.push(fetch(l.href).then(s=>s.text()).then(s=>{let i=document.createElement("style");i.innerHTML=s,l.replaceWith(i)}));await Promise.all(c),document.body.append(a),n(a)}),tt[t].then(n=>x(n.content.cloneNode(!0),e))}return x(a.content.cloneNode(!0),e)}function fe(t,e={}){let a=document.createElement("template");return a.dataset.name="anonymous",a.innerHTML=t,x(a.content.cloneNode(!0),e)}function x(t,e={}){let a=(n,o)=>{let c=n.match(/{{[^}]+}}/g).map(j),l=n,s=()=>{n=l;for(let i of c){let u=d(i.value);n=n.replace(i.text,u??"<null>")}return n};for(let i of c){let u=h(e,i.prop);if(u==null&&console.warn(`{{ ${i.prop} }}: No value for this key`,{key:i.prop,value:u}),m(u)){let p=u;for(let f in i.meta)if(S[f]){let g=S[f];p=p.map(v=>g({value:v,key:i.prop,param:i.meta[f],options:i.meta}))}i.value=p,p.subscribe({next:()=>o(s())})}else{let p=u;for(let f in i.meta)if(S[f]){let g=S[f];p=g({value:d(u),key:i.prop,param:i.meta[f],options:i.meta})}i.value=()=>p}}o(s())},r=(n,o=new WeakSet)=>{let c=!1;if(!(B(n)||o.has(n))){if(n.nodeName=="#document-fragment"&&L(n,e),n instanceof HTMLElement){let l=n.getAttributeNames();L(n,e);for(let s of Z)n.matches(s.select)&&s.run(n,e,()=>c=!0);if(c)return;for(let s of l){let i=n.getAttribute(s);i?.includes("{{")?a(i,u=>{u=u.trim().replace(/ +/," "),u==="<null>"?n.removeAttribute(s):n.setAttribute(s,u)}):n.localName.includes("-")&&I(e,i)&&n.setAttribute(s,`@parent.${i}`)}}else if(n instanceof Text&&n.textContent.includes("{{")){let l=n.textContent.split(/{{|}}/g);for(let s=0,i=n,u;s<l.length;s++)u=document.createTextNode(l[s]),s%2!=0&&a(`{{${l[s]}}}`,p=>u.data=p.replaceAll("<null>","")),o.add(u),i.after(u),i=u;n.remove()}o.add(n);for(let l of n.childNodes)r(l,o)}};return r(t,new WeakSet),t}function be(t,e,a){customElements.define(t,class extends HTMLElement{static observedAttributes=Object.keys(e).map(r=>r.toLowerCase());#e=Object.fromEntries(Object.entries(e).map(r=>[r[0],b(r[1])]));#t={};#r=!1;on(r,n,o=null){this.addEventListener(r,n,o)}querySelector(r){return this.shadowRoot.querySelector(r)}querySelectorAll(r){return this.shadowRoot.querySelectorAll(r)}async connectedCallback(){if(this.hasAttribute("data-lazy")&&await w(this),this.dispatchEvent(new CustomEvent("::load",{bubbles:!0})),this.#r){this.dispatchEvent(new CustomEvent("::loaded",{bubbles:!0})),this.dispatchEvent(new CustomEvent("::mount"));return}let r=this.shadowRoot??this.attachShadow({mode:"open"}),n=a(this.#e,this);(c=>{L(this,k(c)),this.dispatchEvent(new CustomEvent("::loaded",{bubbles:!0})),r.append(c),this.#r=!0,this.#t["::attributes"]=new AbortController;for(let l in e)this.hasAttribute(l)||this.setAttribute(l,e[l].toString()),this.#e[l].subscribe({next:s=>this.setAttribute(l,s.toString())},{signal:this.#t["::attributes"].signal});this.dispatchEvent(new CustomEvent("::mount"))})(n instanceof Promise?await n:n)}disconnectedCallback(){z(this);for(let r in this.#t)this.#t[r].abort(),delete this.#t[r];this.dispatchEvent(new CustomEvent("::unmount"))}#n(r=""){r=r.toLowerCase();for(let n in this.#e)if(n.toLowerCase()==r)return[e[n],this.#e[n]];return[null,null]}attributeChangedCallback(r,n,o){let[c,l]=this.#n(r);if(o.startsWith("@parent.")){let s=this.parentNode.host||this.parentNode,i=o.slice(8),u=h(k(s),i)??h(k(this),i);m(u)?(this.#t[c]?.abort(),this.#t[c]=new AbortController,l(d(u)),u.subscribe({next:l},{signal:this.#t[c].signal})):l(u)}else l(typeof c=="number"?parseFloat(o):o)}})}var et=new WeakMap;function ye(t,e=null){document.dispatchEvent(new CustomEvent(t,{detail:e}))}function we(t,e){let a=r=>e(r.detail);et.set(e,a),document.addEventListener(t,a)}function ve(t){return new Promise(e=>{let a=r=>e(r.detail);document.addEventListener(t,a,{once:!0})})}function Se(t,e){document.removeEventListener(t,et.get(e))}export{be as component,z as deletePropsOf,at as effect,ye as emit,j as expression,d as f,I as hasProp,B as hasProps,m as isSignal,bt as memo,Se as off,we as on,ve as once,S as pipes,Z as plugins,h as prop,k as propsOf,st as resource,gt as resourceBy,L as setPropsOf,b as signal,ue as templateByName,x as templateByNode,fe as templateByString};
