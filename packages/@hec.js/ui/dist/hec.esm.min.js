function I(t){let r=t.matchAll(/([^ {}\s]+)/g),n={meta:{},text:t,prop:null};for(let e of r)if(e[1].includes("=")){let a=e[1].split("=");n.meta[a[0]]=a[1].replaceAll(/'|"/g,"")}else n.prop=e[1];return n}var A={};var U=new WeakMap;function _(t,r=null){document.dispatchEvent(new CustomEvent(t,{detail:r}))}function j(t,r){let n=e=>r(e.detail);U.set(r,n),document.addEventListener(t,n)}function St(t){return new Promise(r=>{let n=e=>r(e.detail);document.addEventListener(t,n,{once:!0})})}function At(t,r){document.removeEventListener(t,U.get(r))}var q={items:new Map,setItem(t,r){this.items.set(t,r?.toString())},get length(){return this.items.keys().length},key(t){return Array.from(this.items.values()).at(t)},clear(){this.items.clear()},getItem(t){return this.items.get(t)},removeItem(t){this.items.delete(t)}},N=new Map;function ut(t){try{let r=window[t+"Storage"];return typeof r.length=="number"?r:q}catch{return q}}window.addEventListener("storage",t=>{if(!N.has(t.key))return;let r=N.get(t.key),n=t.storageArea.getItem(t.key);typeof n=="string"&&n!=="undefined"&&r.update(JSON.parse(n))});function h(t=null,r={}){if(r.id&&N.has(r.id))return N.get(r.id);let n=[],e=r.storage&&ut(r.storage),a=s=>{t=s,e&&e.setItem(r.id,JSON.stringify(t));for(let c of n)c.next(t)};function o(){return arguments.length&&t!==arguments[0]&&a(arguments[0]),t}let i=(s,c=null)=>{n.push(s),c?.signal.addEventListener("abort",()=>{let u=n.indexOf(s);u>-1&&n.splice(u,1)},{once:!0})};if(e){let s=e.getItem(r.id);a(typeof s=="string"&&s!=="undefined"?JSON.parse(s):t)}let l=Object.assign(o,{id:r.id,storage:r.storage,toString:()=>t?.toString(),set:s=>t=s,update:a,subscribe:i,map:s=>{let c=h(s(t)),u=new AbortController,m=c.subscribe;return i({next:f=>c(s(f))},{signal:u.signal}),Object.assign(c,{set:()=>null,subscribe:(f,x)=>{m(f,x),x?.signal.addEventListener("abort",()=>u.abort())}})},filter:s=>{let c=h(s(t)?t:null);return i({next:u=>s(u)?c(u):null}),Object.assign(c,{set:()=>null})}});return r.id&&N.set(r.id,l),l}function mt(t,r=[],n=null){for(let e of r)e.subscribe({next:()=>n=t(n)});return t(n)}function kt(t,r=[],n=null){let e=h(null);return e(mt(a=>e(t(a)),r,n)),e}function ft(t,r=null){let n=h(r),e=h("loaded"),a=async()=>{if(e()!="pending"){try{e("pending"),n(await t()),e("loaded"),delete n.error}catch(o){e("error"),n.error=o}return n()}};return a(),Object.assign(n,{state:e,refetch:a})}function Et(t,r,n=null){let e=ft(()=>r(d(t)),n);return p(t)&&t.subscribe({next:()=>e.refetch()}),e}function p(t){return t&&t.subscribe}function Mt(t,r=[]){function n(){let e=h(null),a=null,o=null,i=(l,s)=>{a=l,o=s,e(t(l,o))};for(let l of r)l.subscribe({next:()=>e(t(a,o))});return Object.assign({provide:i},e)}return n}var d=t=>typeof t=="function"?d(t()):t;function g(t,r){let n=r.split(".");if(!r)return t;if(!t)return null;for(let e of n){if(["state"].includes(e)&&t?.state)return t[e];if(p(t)){let a=t()?.[e];if(p(a)){let o=new AbortController,i=h(a());a.subscribe({next:i},{signal:o.signal});let l=s=>{o.abort(),p(s[e])?(o=new AbortController,s[e].subscribe({next:i},{signal:o.signal}),i(s[e]())):i(s[e])};t.subscribe({next:l}),t=i}else t=t.map(o=>o&&o[e])}else if(typeof t=="function")t=d(t);else if(typeof t[e]<"u")typeof t[e]=="function"&&!p(t[e])?t=t[e].bind(t):t=t[e];else return}return t}function Ot(t,r){let n=r.split(".");if(!r||!t)return!1;for(let e of n){if(["loading","error"].includes(e)&&t?.loading&&t?.error)return t[e];if(typeof t=="function")t=d(t);else if(typeof t[e]<"u")t=t[e];else return!1}return!0}var $="[data-component], [data-view], [data-page]",k=new Map,w=new WeakMap,pt=new MutationObserver(t=>{for(let r of t)w.has(r.target)&&w.get(r.target)(r.attributeName)});function F(t,r,n){k.set(t,async(e,a)=>{let o={},i=Array.from(e.childNodes),l=c=>{let u=e.getAttribute(c);for(let m in o)m.toLowerCase()==c&&o[m](typeof r[m]=="number"?parseFloat(u):u)};for(let c in r){let u=e.getAttribute(c);if(typeof u=="string"&&u.startsWith("@")){let m=g(a,u.substring(1));o[c]=p(m)?m:h(m)}else o[c]=h(typeof r[c]=="number"?parseFloat(u):u),o[c].subscribe({next:m=>m?e.setAttribute(c,m):e.removeAttribute(c)})}pt.observe(e,{attributeFilter:Object.keys(r).map(c=>c.toLowerCase())}),w.set(e,l);let s=n(o,e);if(s instanceof Promise&&(s=await s),e.append(s),i.length){let c=e.querySelector("slot"),u=document.createComment("children/"),m=document.createComment("/children");c?c.replaceWith(u,...i,m):e.append(u,...i)}e.dispatchEvent(new CustomEvent("::mount"))}),_("::component/"+t)}var Tt=F,It=F;var L=new WeakMap,E=new WeakMap,H=new IntersectionObserver(t=>{for(let r of t)if(r.isIntersecting&&L.has(r.target))for(let n of L.get(r.target))n(),L.delete(r.target),H.unobserve(r.target)},{rootMargin:"256px"});new MutationObserver(t=>{for(let r of t){let n=a=>{for(let o of a){if(w.has(o)&&o.dispatchEvent(new CustomEvent("::mount")),E.has(o)){let i=E.get(o);for(;i.length;)i.shift()()}n(o.childNodes)}},e=a=>{for(let o of a)w.has(o)&&o.dispatchEvent(new CustomEvent("::unmount"))};n(r.addedNodes),e(r.removedNodes)}}).observe(document,{childList:!0,subtree:!0});function v(t){return new Promise(r=>{let n=L.get(t)??[];n.push(r),L.set(t,n),H.observe(t)})}function M(t){return new Promise(r=>{let n=E.get(t)??[];t.getRootNode()==document&&queueMicrotask(()=>r()),n.push(r),E.set(t,n)})}var dt=h({}),P=h(location.pathname),Q=window.history.pushState,ht=window.history.replaceState,R={updateQueued:!1},C=document.querySelector('head meta[name="route"]')||document.createElement("meta");C.name="route";C.content=location.pathname;document.head.append(C);var G=[],V=new WeakMap;function gt(t,r){let n=Array.from(t.path.matchAll(/\:/g)).length*25,e=Array.from(r.path.matchAll(/\:/g)).length*25;return n+=Array.from(t.path.matchAll(/\*/g)).length*150,e+=Array.from(r.path.matchAll(/\*/g)).length*150,n-e}function B(t){let r=t.node,n=t.path,e=t.placeholder,a=r.parentElement??e?.parentElement,o=a?.closest("[data-route]"),i=V.get(o),l=i?.pattern?.pathname,s=i?.group??G;if(a?.getRootNode()!==document)return M(e).then(()=>B(t));t.group=[],V.set(r,t),l&&(n=n=="/"?"":n,n=l.replaceAll(/[^\/a-zA-Z0-9]+$/gm,"")+n.replaceAll(/^[^\/a-zA-Z0-9]+/gm,"")),n=n.replaceAll(/\/+/g,"/").replace(/\/$/m,""),t.pattern=new URLPattern({pathname:n||"/"}),s.push(t),s.sort(gt),R.updateQueued||(R.updateQueued=!0,queueMicrotask(y))}function y(t=location.href){t=t.replace(/index\.*[a-z0-9]*$/gm,"");let r=!1,n=e=>{let a=!1;for(let o of e){let i=o.pattern.test(t);o.update(!a&&i),!a&&i&&(a=!0,o.group.length?n(o.group):(r=!0,C.content=o.pattern.pathname))}return r};return R.updateQueued=!1,n(G)?(P(t),dt(Object.fromEntries(new URLSearchParams(location.search)))):y(P()),r}var bt=t=>{let r=t.target.closest("a")?.href,n=new URL(r,location.href);r&&n.hostname==location.hostname&&y(r)&&(Q.call(window.history,null,null,r),t.preventDefault())};window.addEventListener("popstate",()=>y());window.addEventListener("hashchange",()=>y());window.addEventListener("click",bt);window.history.pushState=function(r,n,e){Q.call(window.history,r,n,e),y(e.toString())};window.history.replaceState=function(r,n,e){ht.call(window.history,r,n,e),y(e.toString())};var J={select:t=>t.matches("[data-if], [data-if-not]"),run:(t,r)=>{let n=t.dataset.if||t.dataset.ifNot,e=g(r,n),a=!!t.dataset.ifNot,o=document.createComment((a?"if not:":"if: ")+n),i=T(t,o,r,a);t.replaceWith(o),i(d(e)),t.removeAttribute("data-group"),p(e)&&e.subscribe({next:i})}};function xt(t,r){if("group"in t.dataset&&t instanceof HTMLTemplateElement){let n=Array.from(t.content.childNodes);for(let e of n)b(e,r);return n}return[t]}function T(t,r,n,e=!1){let a=xt(t,n),o=!!t.closest("head");return i=>{if(i=e?!i:i,!t.parentNode&&i)t.hidden=!1,r.replaceWith(...a);else if(!r.parentNode&&!i&&!o)for(let l of a)l.replaceWith(r)}}var D={select:t=>t.matches("[data-route]"),run:async(t,r)=>{"URLPattern"in window||await import("https://kevinblt.github.io/hec/packages/@hec.js/ui/dist/urlpattnern.min.js");let n=t.dataset.route,e=document.createComment("route: "+n),a=T(t,e,r);B({path:n,update:a,node:t,placeholder:e}),t.removeAttribute("data-group"),t.replaceWith(e)}},Z={select:t=>t.matches("[data-match], [href]"),run:t=>{let r=t.dataset.match??"--active",n=o=>o.replace(/index\.*[a-z0-9]*$/gm,"");function e(o){return n(new URL(o,location.href).pathname)}let a=o=>{e(t.getAttribute("href"))==e(o)?t.classList.add(r):t.classList.remove(r)};P.subscribe({next:a}),a(location.pathname),t.removeAttribute("data-match")}};var K={number:t=>t.valueAsNumber,date:t=>t.valueAsDate,text:t=>t.value,checkbox:t=>t.checked,"":t=>t.value},X={select:t=>t.matches("[data-bind]"),run:(t,r)=>{let n=t.dataset.bind||t.getAttribute("name"),e=g(r,n);if(e){let a=o=>{t.type=="checkbox"?t.checked=o:t.value=o};a(d(e)),p(e)&&(e.subscribe({next:a}),t.addEventListener("input",()=>e(K[t.type]?.(t)??t.value)),t.addEventListener("change",()=>e(K[t.type]?.(t)??t.value)))}}};var S=new WeakSet,Y={select:t=>t.matches("[data-lazy]"),run:(t,r,n)=>{if(S.has(t))return;S.add(t);let e=()=>{t.removeAttribute("data-lazy");for(let a of t.childNodes)b(a,r)};v(t).then(e),n()}};var O=new WeakSet,tt={select:t=>t.matches("[data-include]"),run:(t,r)=>{if(O.has(t)||t.children.length)return;O.add(t);let n=async()=>{t.dispatchEvent(new CustomEvent("::load",{bubbles:!0})),t.classList.add("--loading");let e=await fetch(t.dataset.include,{headers:{accept:"text/html,text/*"}});if(e.ok){let a=await e.text(),o=document.createElement("div");t.dispatchEvent(new CustomEvent("::loaded",{bubbles:!0})),o.innerHTML=a;for(let i of o.childNodes)b(i,r);"group"in t.dataset?t.replaceWith(...o.childNodes):t.append(...o.childNodes),t.removeAttribute("data-include"),t.removeAttribute("data-lazy"),t.removeAttribute("data-group"),t.classList.remove("--loading")}};t.hasAttribute("data-lazy")?(S.add(t),v(t).then(n)):n()}};var et=new WeakSet,rt={select:t=>t.matches("[data-for]"),run:(t,r,n)=>{if(et.has(t))return;let e=t.dataset.for.replace("let","").split("of"),a=e[0].split(","),o=e.at(-1).trim(),i=a[0].trim()==o?"__e":a[0].trim(),l=a[1]?.trim()??"__i",s=g(r,o),c=document.createComment(t.dataset.for);t.replaceWith(c),O.add(t);let u=()=>{let f=c;for(;(f=f.nextSibling)&&((f instanceof HTMLElement||f instanceof SVGElement)&&f.dataset.for==t.dataset.for);)f=f.previousSibling,f.nextSibling.remove()},m=f=>{if(u(),!f||!f[Symbol.iterator])return console.warn("data-for: The value given is not iterable.",{key:o,value:f});for(let x=0,W=c;x<f.length;x++){let z=t.cloneNode(!0),lt=Object.assign({},r,{[i]:f[x],[l]:x});et.add(z),W.after(z),b(z,lt),W=W.nextSibling}};queueMicrotask(()=>m(d(s))),p(s)&&s.subscribe({next:m}),n()}};var nt={select:t=>Object.keys(t.dataset).some(r=>r.startsWith("on.")),run:(t,r)=>{for(let n in t.dataset)n.startsWith("on.")&&t.addEventListener(n.split(".")[1],g(r,t.dataset[n]))}};var ot=new WeakSet,at={select:t=>t.matches($),run:(t,r)=>{let n=t.dataset.component??t.dataset.view??t.dataset.page;if(ot.has(t)||!t.parentNode)return;ot.add(t);let e=async()=>{if(!k.has(n))return j("::component/"+n,e);t.removeAttribute("data-lazy"),t.classList.add("--loading"),await k.get(n)(t,r),t.classList.remove("--loading")};t.hasAttribute("data-lazy")?(S.add(t),v(t).then(e)):M(t).then(e)}};var it=[rt,at,J,D,tt,nt,X,Z,Y];var st={};function Te(t,r={}){t instanceof URL&&(t=t.host==location.host?t.pathname:t.toString());let n=document.querySelector(`template[name="${t}"]`);if(!n){let e=document.querySelector('head meta[name="template-path"]');return st[t]??=new Promise(async a=>{n=document.createElement("template"),n.setAttribute("id",t.toString()),n.innerHTML=await fetch(e?.content?.replaceAll("[name]",t.toString())??t).then(o=>o.text()),document.body.append(n),a(n)}),st[t].then(a=>b(a.content.cloneNode(!0),r))}return b(n.content.cloneNode(!0),r)}function Ie(t,r={}){let n=document.createElement("template");return n.dataset.name="anonymous",n.innerHTML=t,b(n.content.cloneNode(!0),r)}function b(t,r={}){let n=(e,a=new WeakSet)=>{let o=!1;if(!a.has(e)){if(e instanceof HTMLElement||e instanceof SVGElement){for(let i of it)i.select(e)&&i.run(e,r,()=>o=!0);if((e.parentNode||!e.dataset.for)&&yt(e,r),o)return}else if(e instanceof Text&&e.textContent.includes("{{")){let i=e.textContent.split(/{{|}}/g);for(let l=0,s=e,c;l<i.length;l++)c=document.createTextNode(i[l]),l%2!=0&&ct(`{{${i[l]}}}`,r,u=>c.data=u),a.add(c),s.after(c),s=c;e.remove()}a.add(e);for(let i of e.childNodes)n(i,a)}};return n(t,new WeakSet),t}var yt=(t,r)=>{let n=t.getAttributeNames();for(let e of n){let a=t.getAttribute(e);a?.includes("{{")&&ct(a,r,o=>{o=o.replace(/ +/," ").trim(),o==="undefined"||o==="null"?t.removeAttribute(e):t.setAttribute(e,o)})}},ct=(t,r,n)=>{let e=t.match(/{{[^}]+}}/g).map(I),a=t,o=()=>{t=a;for(let i of e)t=t.replace(i.text,d(i.value));return t};for(let i of e){let l=null;if(i.prop[i.prop.length-1]===")"){let s=i.prop.split("("),c=g(r,s[1].substring(0,s[1].length-1).trim()),u=s[0].trim();l=g(r,u),l=l(),l.provide(d(c),i.meta),p(c)&&c.subscribe({next:m=>l.provide(d(m),i.meta)})}else l=g(r,i.prop);if(l==null&&console.warn(`{{ ${i.prop} }}: No value for this key`,{key:i.prop,value:l}),p(l)){let s=l;for(let c in i.meta)if(A[c]){let u=A[c];s=s.map(m=>u({value:m,key:i.prop,param:i.meta[c],options:i.meta}))}i.value=s,s.subscribe({next:()=>n(o())})}else{let s=l;for(let c in i.meta)if(A[c]){let u=A[c];s=u({value:d(l),key:i.prop,param:i.meta[c],options:i.meta})}i.value=()=>s}}n(o())};var _e=t=>{let r=document.head.querySelector(`link[rel="preload"][href="${t.href}"]`)??document.createElement("link");Object.assign(r,t),r.rel="preload",document.head.append(r)};export{F as component,$ as componentSelector,w as componentUpdate,k as components,mt as effect,_ as emit,yt as executeNodeAttributesTemplate,I as expression,d as f,Ot as hasProp,p as isSignal,kt as memo,At as off,j as on,St as once,It as page,A as pipes,it as plugins,_e as preload,g as prop,Mt as provider,ft as resource,Et as resourceBy,h as signal,Te as templateByName,b as templateByNode,Ie as templateByString,Tt as view};
