function U(t){let r=t.matchAll(/([^ {}\s]+)/g),n={meta:{},text:t,prop:null};for(let e of r)if(e[1].includes("=")){let a=e[1].split("=");n.meta[a[0]]=a[1].replaceAll(/'|"/g,"")}else n.prop=e[1];return n}var S={};var _=new WeakMap;function q(t,r=null){document.dispatchEvent(new CustomEvent(t,{detail:r}))}function $(t,r){let n=e=>r(e.detail);_.set(r,n),document.addEventListener(t,n)}function St(t){return new Promise(r=>{let n=e=>r(e.detail);document.addEventListener(t,n,{once:!0})})}function Lt(t,r){document.removeEventListener(t,_.get(r))}var F={items:new Map,setItem(t,r){this.items.set(t,r?.toString())},get length(){return this.items.keys().length},key(t){return Array.from(this.items.values()).at(t)},clear(){this.items.clear()},getItem(t){return this.items.get(t)},removeItem(t){this.items.delete(t)}},L=new Map;function ft(t){try{let r=window[t+"Storage"];return typeof r.length=="number"?r:F}catch{return F}}window.addEventListener("storage",t=>{if(!L.has(t.key))return;let r=L.get(t.key),n=t.storageArea.getItem(t.key);typeof n=="string"&&n!=="undefined"&&r.update(JSON.parse(n))});function h(t=null,r={}){if(r.id&&L.has(r.id))return L.get(r.id);let n=[],e=r.storage&&ft(r.storage),a=s=>{t=s,e&&e.setItem(r.id,JSON.stringify(t));for(let i of n)i.next(t)};function o(){return arguments.length&&t!==arguments[0]&&a(arguments[0]),t}let c=(s,i=null)=>{n.push(s),i?.signal.addEventListener("abort",()=>{let u=n.indexOf(s);u>-1&&n.splice(u,1)},{once:!0})};if(e){let s=e.getItem(r.id);a(typeof s=="string"&&s!=="undefined"?JSON.parse(s):t)}let l=Object.assign(o,{id:r.id,storage:r.storage,toString:()=>t?.toString(),set:s=>t=s,update:a,subscribe:c,map:s=>{let i=h(s(t)),u=new AbortController,f=i.subscribe;return c({next:m=>i(s(m))},{signal:u.signal}),Object.assign(i,{set:()=>null,subscribe:(m,x)=>{f(m,x),x?.signal.addEventListener("abort",()=>u.abort())}})},filter:s=>{let i=h(s(t)?t:null);return c({next:u=>s(u)?i(u):null}),Object.assign(i,{set:()=>null})}});return r.id&&L.set(r.id,l),l}function pt(t,r=[],n=null){for(let e of r)e.subscribe({next:()=>n=t(n)});return t(n)}function Pt(t,r=[],n=null){let e=h(null);return e(pt(a=>e(t(a)),r,n)),e}function dt(t,r=null){let n=h(r),e=h("loaded"),a=async()=>{if(e()!="pending"){try{e("pending"),n(await t()),e("loaded"),delete n.error}catch(o){e("error"),n.error=o}return n()}};return a(),Object.assign(n,{state:e,refetch:a})}function Mt(t,r,n=null){let e=dt(()=>r(d(t)),n);return p(t)&&t.subscribe({next:()=>e.refetch()}),e}function p(t){return t&&t.subscribe}function Ot(t,r=[]){function n(){let e=h(null),a=null,o=null,c=(l,s)=>{a=l,o=s,e(t(l,o))};for(let l of r)l.subscribe({next:()=>e(t(a,o))});return Object.assign(e,{provide:c})}return n}var d=t=>typeof t=="function"?d(t()):t;function b(t,r){let n=r?.split(".");if(!r)return t;if(!t)return null;for(let e of n){if(["state"].includes(e)&&t?.state)return t[e];if(p(t)){let a=t()?.[e];if(p(a)){let o=new AbortController,c=h(a());a.subscribe({next:c},{signal:o.signal});let l=s=>{o.abort(),p(s[e])?(o=new AbortController,s[e].subscribe({next:c},{signal:o.signal}),c(s[e]())):c(s[e])};t.subscribe({next:l}),t=c}else t=t.map(o=>o&&o[e])}else if(typeof t=="function")t=d(t);else if(typeof t[e]<"u")typeof t[e]=="function"&&!p(t[e])?t=t[e].bind(t):t=t[e];else return}return t}function zt(t,r){let n=r.split(".");if(!r||!t)return!1;for(let e of n){if(["loading","error"].includes(e)&&t?.loading&&t?.error)return t[e];if(typeof t=="function")t=d(t);else if(typeof t[e]<"u")t=t[e];else return!1}return!0}var H="[data-component], [data-view], [data-page]",E=new Map,v=new WeakMap,ht=new MutationObserver(t=>{for(let r of t)v.has(r.target)&&v.get(r.target)(r.attributeName)});function V(t,r,n){E.set(t,async(e,a)=>{let o={},c=Array.from(e.childNodes),l=i=>{let u=e.getAttribute(i);for(let f in o)f.toLowerCase()==i&&o[f](typeof r[f]=="number"?parseFloat(u):u)};for(let i in r){let u=e.getAttribute(i)??r[i];if(typeof u=="string"&&u.startsWith("@")){let f=b(a,u.substring(1));o[i]=p(f)?f:h(f)}else o[i]=h(typeof r[i]=="number"?parseFloat(u):u),o[i].subscribe({next:f=>f?e.setAttribute(i,f):e.removeAttribute(i)})}ht.observe(e,{attributeFilter:Object.keys(r).map(i=>i.toLowerCase())}),v.set(e,l);let s=n(o,e);if(s instanceof Promise&&(s=await s),e.append(s),c.length){let i=e.querySelector("slot"),u=document.createComment("children/"),f=document.createComment("/children");if(i){for(let m of c)m instanceof Element&&i.getAttributeNames().forEach(x=>m.setAttribute(x,i.getAttribute(x)));i.replaceWith(u,...c,f)}else e.append(u,...c);for(let m of c)g(m,Object.assign({},a,B.get(s)))}e.dispatchEvent(new CustomEvent("::mount"))}),q("::component/"+t)}var Ut=V,_t=V;var k=new WeakMap,P=new WeakMap,Q=new IntersectionObserver(t=>{for(let r of t)if(r.isIntersecting&&k.has(r.target))for(let n of k.get(r.target))n(),k.delete(r.target),Q.unobserve(r.target)},{rootMargin:"256px"});new MutationObserver(t=>{for(let r of t){let n=a=>{for(let o of a){if(v.has(o)&&o.dispatchEvent(new CustomEvent("::mount")),P.has(o)){let c=P.get(o);for(;c.length;)c.shift()()}n(o.childNodes)}},e=a=>{for(let o of a)v.has(o)&&o.dispatchEvent(new CustomEvent("::unmount"))};n(r.addedNodes),e(r.removedNodes)}}).observe(document,{childList:!0,subtree:!0});function w(t){return new Promise(r=>{let n=k.get(t)??[];n.push(r),k.set(t,n),Q.observe(t)})}function M(t){return new Promise(r=>{let n=P.get(t)??[];t.getRootNode()==document&&queueMicrotask(()=>r()),n.push(r),P.set(t,n)})}var gt=h({}),O=h(location.pathname),J=window.history.pushState,bt=window.history.replaceState,j={updateQueued:!1},W=document.querySelector('head meta[name="route"]')||document.createElement("meta");W.name="route";W.content=location.pathname;document.head.append(W);var D=[],G=new WeakMap;function xt(t,r){let n=Array.from(t.path.matchAll(/\:/g)).length*25,e=Array.from(r.path.matchAll(/\:/g)).length*25;return n+=Array.from(t.path.matchAll(/\*/g)).length*150,e+=Array.from(r.path.matchAll(/\*/g)).length*150,n-e}function Qt(t=""){window.history.pushState(null,null,t)}function T(t){let r=t.node,n=t.path,e=t.placeholder,a=r.parentElement??e?.parentElement,o=a?.closest("[data-route]"),c=G.get(o),l=c?.pattern?.pathname,s=c?.group??D;if(a?.getRootNode()!==document)return M(e).then(()=>T(t));t.group=[],G.set(r,t),l&&(n=n=="/"?"":n,n=l.replaceAll(/[^\/a-zA-Z0-9]+$/gm,"")+n.replaceAll(/^[^\/a-zA-Z0-9]+/gm,"")),n=n.replaceAll(/\/+/g,"/").replace(/\/$/m,""),t.pattern=new URLPattern({pathname:n||"/"}),s.push(t),s.sort(xt),j.updateQueued||(j.updateQueued=!0,queueMicrotask(y))}function y(t=location.href){t=t.replace(/index\.*[a-z0-9]*$/gm,"");let r=!1,n=e=>{let a=!1;for(let o of e){let c=o.pattern.test(t);o.update(!a&&c),!a&&c?(a=!0,o.node.classList.add("--active"),o.group.length?n(o.group):(r=!0,W.content=o.pattern.pathname)):(o.node.classList.remove("--active"),o.node.className||o.node.removeAttribute("class"))}return r};return j.updateQueued=!1,n(D)?(O(t),gt(Object.fromEntries(new URLSearchParams(location.search)))):y(O()),r}var yt=t=>{let r=t.target.closest("a")?.href,n=new URL(r,location.href);r&&n.hostname==location.hostname&&y(r)&&(J.call(window.history,null,null,r),t.preventDefault())};window.addEventListener("popstate",()=>y());window.addEventListener("hashchange",()=>y());window.addEventListener("click",yt);window.history.pushState=function(r,n,e){J.call(window.history,r,n,e),y(e.toString())};window.history.replaceState=function(r,n,e){bt.call(window.history,r,n,e),y(e.toString())};var Z={select:t=>t.matches("[data-if], [data-if-not]"),run:(t,r)=>{let n=t.dataset.if||t.dataset.ifNot,e=!!t.dataset.ifNot,a=document.createComment((e?"if not:":"if: ")+n),o=I(t,a,r,e);t.replaceWith(a),t.removeAttribute("data-group"),A(n,r,o,!1)}};function vt(t,r){if("group"in t.dataset&&t instanceof HTMLTemplateElement){let n=Array.from(t.content.childNodes);for(let e of n)g(e,r);return n}return[t]}function I(t,r,n,e=!1){let a=vt(t,n),o=!!t.closest("head");return c=>{if(c=e?!c:c,!t.parentNode&&c)t.hidden=!1,r.replaceWith(...a);else if(!r.parentNode&&!c&&!o)for(let l of a)l.replaceWith(r)}}var K={select:t=>t.matches("[data-route]"),run:async(t,r)=>{"URLPattern"in window||await import("https://kevinblt.github.io/hec/packages/@hec.js/ui/dist/urlpattnern.min.js");let n=t.dataset.route,e=document.createComment("route: "+n),a=I(t,e,r);T({path:n,update:a,node:t,placeholder:e}),t.removeAttribute("data-group"),t.replaceWith(e)}},X={select:t=>t.matches("[data-match], [href]"),run:t=>{if(!t.parentNode)return;let r=t.dataset.match??"--active",n=o=>o.replace(/index\.*[a-z0-9]*$/gm,"");function e(o){return n(new URL(o,location.href).pathname)}let a=o=>{e(t.getAttribute("href"))==e(o)?t.classList.add(r):(t.classList.remove(r),t.className||t.removeAttribute("class"))};O.subscribe({next:a}),queueMicrotask(()=>a(location.pathname)),t.removeAttribute("data-match")}};var Y={number:t=>t.valueAsNumber,date:t=>t.valueAsDate,text:t=>t.value,checkbox:t=>t.checked,"":t=>t.value},tt={select:t=>t.matches("[data-bind]"),run:(t,r)=>{let n=t.dataset.bind||t.getAttribute("name"),e=b(r,n);if(e){let a=o=>{t.type=="checkbox"?t.checked=o:t.value=o};a(d(e)),p(e)&&(e.subscribe({next:a}),t.addEventListener("input",()=>e(Y[t.type]?.(t)??t.value)),t.addEventListener("change",()=>e(Y[t.type]?.(t)??t.value)))}}};var N=new WeakSet,et={select:t=>t.matches("[data-lazy]"),run:(t,r,n)=>{if(N.has(t))return;N.add(t);let e=()=>{t.removeAttribute("data-lazy");for(let a of t.childNodes)g(a,r)};w(t).then(e),n()}};var C=new WeakSet,rt={select:t=>t.matches("[data-include]"),run:(t,r)=>{if(C.has(t)||t.children.length)return;C.add(t);let n=async()=>{t.dispatchEvent(new CustomEvent("::load",{bubbles:!0})),t.classList.add("--loading");let e=await fetch(t.dataset.include,{headers:{accept:"text/html,text/*"}});if(e.ok){let a=await e.text(),o=document.createElement("div");t.dispatchEvent(new CustomEvent("::loaded",{bubbles:!0})),o.innerHTML=a;for(let c of o.childNodes)g(c,r);"group"in t.dataset?t.replaceWith(...o.childNodes):t.append(...o.childNodes),t.removeAttribute("data-include"),t.removeAttribute("data-lazy"),t.removeAttribute("data-group"),t.classList.remove("--loading"),t.className||t.removeAttribute("class")}};t.hasAttribute("data-lazy")?(N.add(t),w(t).then(n)):n()}};var nt=new WeakSet,at={select:t=>t.matches("[data-for]"),run:(t,r,n)=>{if(nt.has(t))return;let e=t.dataset.for.replace("let","").split("of"),a=e[0].split(","),o=e.at(-1).trim(),c=a[0].trim()==o?"__e":a[0].trim(),l=a[1]?.trim()??"__i",s=b(r,o),i=document.createComment(t.dataset.for);t.replaceWith(i),C.add(t);let u=()=>{let m=i;for(;(m=m.nextSibling)&&((m instanceof HTMLElement||m instanceof SVGElement)&&m.dataset.for==t.dataset.for);)m=m.previousSibling,m.nextSibling.remove()},f=m=>{if(u(),!m||!m[Symbol.iterator])return console.warn("data-for: The value given is not iterable.",{key:o,value:m});for(let x=0,z=i;x<m.length;x++){let R=t.cloneNode(!0),mt=Object.assign({},r,{[c]:m[x],[l]:x});nt.add(R),z.after(R),g(R,mt),z=z.nextSibling}};queueMicrotask(()=>f(d(s))),p(s)&&s.subscribe({next:f}),n()}};var ot={select:t=>Object.keys(t.dataset).some(r=>r.startsWith("on.")),run:(t,r)=>{for(let n in t.dataset)if(n.startsWith("on.")){let e=t.dataset[n];t.removeAttribute(n),t.addEventListener(n.split(".")[1],b(r,e))}}};var st=new WeakSet,it={select:t=>t.matches(H),run:(t,r,n)=>{let e=t.dataset.component??t.dataset.view??t.dataset.page;if(st.has(t)||!t.parentNode)return;st.add(t);let a=async()=>{if(!E.has(e))return $("::component/"+e,a);t.removeAttribute("data-lazy"),t.classList.add("--loading"),await E.get(e)(t,r),t.classList.remove("--loading"),t.className||t.removeAttribute("class")};t.hasAttribute("data-lazy")?(N.add(t),w(t).then(a)):M(t).then(a),n()}};var ct={select:t=>Object.keys(t.dataset).some(r=>r.startsWith("class.")),run:(t,r)=>{if(!t.parentNode)return;let n=(e,a)=>{e?t.classList.add(a):(t.classList.remove(a),t.className||t.removeAttribute("class"))};for(let e of t.getAttributeNames())if(e.startsWith("data-class.")){let a=e.split(".")[1],o=t.getAttribute(e);t.removeAttribute(e),A(o,r,c=>n(c,a),!1)}}};var lt=[at,it,Z,K,rt,ot,ct,tt,X,et];var ut={},B=new WeakMap;function Ue(t,r={}){t instanceof URL&&(t=t.host==location.host?t.pathname:t.toString());let n=document.querySelector(`template[name="${t}"]`);if(!n){let e=document.querySelector('head meta[name="template-path"]');return ut[t]??=new Promise(async a=>{n=document.createElement("template"),n.setAttribute("id",t.toString()),n.innerHTML=await fetch(e?.content?.replaceAll("[name]",t.toString())??t).then(o=>o.text()),document.body.append(n),a(n)}),ut[t].then(a=>g(a.content.cloneNode(!0),r))}return g(n.content.cloneNode(!0),r)}function _e(t,r={}){let n=document.createElement("template");return n.innerHTML=t,g(n.content.cloneNode(!0),r)}function g(t,r={}){B.set(t,r);let n=(e,a=new WeakSet)=>{let o=!1;if(!a.has(e)){if(e instanceof HTMLElement||e instanceof SVGElement){for(let c of lt)c.select(e)&&c.run(e,r,()=>o=!0);if((e.parentNode||!e.dataset.for)&&wt(e,r),o)return}else if(e instanceof Text&&e.textContent.includes("{{")){let c=e.textContent.split(/{{|}}/g);for(let l=0,s=e,i;l<c.length;l++)i=document.createTextNode(c[l]),l%2!=0&&A(`{{${c[l]}}}`,r,u=>i.data=u),a.add(i),s.after(i),s=i;e.remove()}a.add(e);for(let c of e.childNodes)n(c,a)}};return n(t,new WeakSet),t}var wt=(t,r)=>{let n=t.getAttributeNames();for(let e of n){let a=t.getAttribute(e);a?.includes("{{")&&A(a,r,o=>{o=o.replace(/ +/," ").trim(),o==="undefined"||o==="null"?t.removeAttribute(e):t.setAttribute(e,o)})}},A=(t,r,n,e=!0)=>{let a=t.match(/{{[^}]+}}/g)?.map(U)??[],o=t;!e&&!a.length&&(a=[{prop:t,meta:{}}]);let c=()=>{t=o;for(let l of a)t=t.replace(l.text,d(l.value));return t};for(let l of a){let s=null;if(l.prop?.[l.prop.length-1]===")"){let i=l.prop.split("("),u=b(r,i[1].substring(0,i[1].length-1).trim()),f=i[0].trim();s=b(r,f),s=s(),s.provide(d(u),l.meta),p(u)&&u.subscribe({next:m=>s.provide(d(m),l.meta)})}else s=b(r,l.prop);if(s==null&&!Object.keys(l.meta).length&&console.warn(`{{ ${l.prop} }}: No value for this key`,{key:l.prop,value:s}),p(s)){let i=s;for(let u in l.meta)if(S[u]){let f=S[u];i=i.map(m=>f({value:m,key:l.prop,param:l.meta[u],options:l.meta}))}l.value=i,i.subscribe({next:u=>n(e?c():u)}),!e&&s.update(d(s))}else{let i=s;for(let u in l.meta)if(S[u]){let f=S[u];i=f({value:d(s),key:l.prop,param:l.meta[u],options:l.meta})}l.value=()=>i,!e&&n(i)}}e&&n(c())};var $e=t=>{let r=document.head.querySelector(`link[rel="preload"][href="${t.href}"]`)??document.createElement("link");Object.assign(r,t),r.rel="preload",document.head.append(r)};export{T as addRoute,A as bindExpressions,V as component,H as componentSelector,v as componentUpdate,E as components,pt as effect,q as emit,wt as executeNodeAttributesTemplate,U as expression,d as f,zt as hasProp,p as isSignal,Pt as memo,Qt as navigate,B as nodeProps,Lt as off,$ as on,St as once,_t as page,S as pipes,lt as plugins,$e as preload,b as prop,Ot as provider,gt as query,dt as resource,Mt as resourceBy,O as route,h as signal,Ue as templateByName,g as templateByNode,_e as templateByString,Ut as view};
