function $(t){let e=t.matchAll(/([^ {}\s]+)/g),r={meta:{},text:t,prop:null};for(let n of e)if(n[1].includes("=")){let a=n[1].split("=");r.meta[a[0]]=a[1].replaceAll(/'|"/g,"")}else r.prop=n[1];return r}var A={};var N=new WeakMap,E=t=>N.get(t),Lt=t=>N.delete(t),q=t=>N.has(t),P=(t,e)=>{let r=E(t);r&&typeof r=="object"?N.set(t,Object.assign(r,e)):N.set(t,e)},p=t=>typeof t=="function"?p(t()):t;function d(t,e){let r=e.split(".");if(!e)return t;for(let n of r){if(["state"].includes(n)&&t?.state)return t[n];if(m(t)){let a=t()?.[n];if(m(a)){let o=new AbortController,s=h(a());a.subscribe({next:s},{signal:o.signal});let l=i=>{o.abort(),m(i[n])?(o=new AbortController,i[n].subscribe({next:s},{signal:o.signal}),s(i[n]())):s(i[n])};t.subscribe({next:l}),t=s}else t=t.map(o=>o&&o[n])}else if(typeof t=="function")t=p(t);else if(typeof t[n]<"u")typeof t[n]=="function"&&!m(t[n])?t=t[n].bind(t):t=t[n];else return}return t}function F(t,e){let r=e.split(".");if(!e)return!1;for(let n of r){if(["loading","error"].includes(n)&&t?.loading&&t?.error)return t[n];if(typeof t=="function")t=p(t);else if(typeof t[n]<"u")t=t[n];else return!1}return!0}var H={items:new Map,setItem(t,e){this.items.set(t,e?.toString())},get length(){return this.items.keys().length},key(t){return Array.from(this.items.values()).at(t)},clear(){this.items.clear()},getItem(t){return this.items.get(t)},removeItem(t){this.items.delete(t)}},L=new Map;function gt(t){try{let e=window[t+"Storage"];return typeof e.length=="number"?e:H}catch{return H}}window.addEventListener("storage",t=>{if(!L.has(t.key))return;let e=L.get(t.key),r=t.storageArea.getItem(t.key);typeof r=="string"&&r!=="undefined"&&e.update(JSON.parse(r))});function h(t=null,e={}){if(e.id&&L.has(e.id))return L.get(e.id);let r=[],n=e.storage&&gt(e.storage),a=i=>{t=i,n&&n.setItem(e.id,JSON.stringify(t));for(let c of r)c.next(t)};function o(){return arguments.length&&t!==arguments[0]&&a(arguments[0]),t}let s=(i,c=null)=>{r.push(i),c?.signal.addEventListener("abort",()=>{let u=r.indexOf(i);u>-1&&r.splice(u,1)},{once:!0})};if(n){let i=n.getItem(e.id);a(typeof i=="string"&&i!=="undefined"?JSON.parse(i):t)}let l=Object.assign(o,{id:e.id,storage:e.storage,toString:()=>t?.toString(),set:i=>t=i,update:a,subscribe:s,map:i=>{let c=h(i(t)),u=new AbortController,b=c.subscribe;return s({next:f=>c(i(f))},{signal:u.signal}),Object.assign(c,{set:()=>null,subscribe:(f,y)=>{b(f,y),y?.signal.addEventListener("abort",()=>u.abort())}})},filter:i=>{let c=h(i(t)?t:null);return s({next:u=>i(u)?c(u):null}),Object.assign(c,{set:()=>null})}});return e.id&&L.set(e.id,l),l}function bt(t,e=[],r=null){for(let n of e)n.subscribe({next:()=>r=t(r)});return t(r)}function Ct(t,e=[],r=null){let n=h(null);return n(bt(a=>n(t(a)),e,r)),n}function xt(t,e=null){let r=h(e),n=h("loaded"),a=async()=>{if(n()!="pending"){try{n("pending"),r(await t()),n("loaded"),delete r.error}catch(o){n("error"),r.error=o}return r()}};return a(),Object.assign(r,{state:n,refetch:a})}function Mt(t,e,r=null){let n=xt(()=>e(p(t)),r);return m(t)&&t.subscribe({next:()=>n.refetch()}),n}function m(t){return t&&t.subscribe}function Wt(t,e=[]){function r(){let n=h(null),a=null,o=s=>{a=s,n(t(s))};for(let s of e)s.subscribe({next:()=>n(t(a))});return Object.assign({provide:o},n)}return r}var yt=h({}),T=h(location.pathname),G=window.history.pushState,wt=window.history.replaceState,j={updateQueued:!1},B=[],U=new WeakMap;function vt(t,e){let r=Array.from(t.path.matchAll(/\:/g)).length*25,n=Array.from(e.path.matchAll(/\:/g)).length*25;return r+=Array.from(t.path.matchAll(/\*/g)).length*150,n+=Array.from(e.path.matchAll(/\*/g)).length*150,r-n}function Q(t){let e=t.node,r=t.path,n=e.parentElement?.closest("[data-route]"),a=U.get(n),o=a?.pattern?.pathname,s=a?.group??B;t.group=[],U.set(e,t),o&&(r=r=="/"?"":r,r=o.replaceAll(/[^\/a-zA-Z0-9]+$/gm,"")+r.replaceAll(/^[^\/a-zA-Z0-9]+/gm,"")),r=r.replaceAll(/\/+/g,"/").replace(/\/$/m,""),t.pattern=new URLPattern({pathname:r||"/"}),s.push(t),s.sort(vt),j.updateQueued||(j.updateQueued=!0,queueMicrotask(v))}var O=document.querySelector('head meta[name="route"]')||document.createElement("meta");O.name="route";O.content=location.pathname;document.head.append(O);var v=()=>{let t=location.href.replace(/index\.*[a-z0-9]*$/gm,"");T(t),yt(Object.fromEntries(new URLSearchParams(location.search)));let e=!1,r=n=>{let a=!1;for(let o of n){let s=o.pattern.test(t);o.update(!a&&s),!a&&s&&(a=!0,o.group.length?r(o.group):(e=!0,O.content=o.pattern.pathname))}return e};return j.updateQueued=!1,r(B)},St=t=>{let e=t.target.closest("a")?.href,r=new URL(e,location.href);e&&r.hostname==location.hostname&&B.some(n=>n.pattern.test(e))&&(G.call(window.history,null,null,e),v()&&t.preventDefault())};window.addEventListener("popstate",v);window.addEventListener("hashchange",v);window.addEventListener("click",St);window.history.pushState=function(e,r,n){G.call(window.history,e,r,n),v()};window.history.replaceState=function(e,r,n){wt.call(window.history,e,r,n),v()};var R=new WeakMap,At=new MutationObserver(t=>{for(let e of t)R.has(e.target)&&R.get(e.target)()}),J={select:"[data-match]",run:t=>{let e=t.dataset.match,r=o=>o.replace(/index\.*[a-z0-9]*$/gm,"");function n(){return r(new URL(t.dataset.route||t.getAttribute("href"),location.href).pathname)}let a=()=>{n()==r(location.pathname)?t.classList.add(e):t.classList.remove(e)};T.subscribe({next:a}),R.set(t,a),At.observe(t,{attributes:!0,attributeFilter:["href","data-route"]}),a(),t.removeAttribute("data-match")}};var K={number:t=>t.valueAsNumber,date:t=>t.valueAsDate,text:t=>t.value,checkbox:t=>t.checked,"":t=>t.value},D={select:"[data-bind],[name]",run:(t,e)=>{let r=t.dataset.bind||t.getAttribute("name"),n=d(e,r);if(n){let a=o=>{t.type=="checkbox"?t.checked=o:t.value=o};a(p(n)),m(n)&&(n.subscribe({next:a}),t.addEventListener("input",()=>n(K[t.type]?.(t)??t.value)),t.addEventListener("change",()=>n(K[t.type]?.(t)??t.value)))}}};var k=new WeakMap,Z=new IntersectionObserver(t=>{for(let e of t)if(e.isIntersecting&&k.has(e.target)){for(let r of k.get(e.target))r();k.delete(e.target),Z.unobserve(e.target)}},{rootMargin:"256px"});function x(t){return new Promise(e=>{let r=k.get(t)??[];r.push(e),k.set(t,r),Z.observe(t)})}var C=new WeakSet,X={select:"[data-include]",run:(t,e)=>{if(C.has(t)||t.children.length)return;C.add(t);let r=t.hasAttribute("data-lazy")&&t.closest("[hidden]"),n=async()=>{t.dispatchEvent(new CustomEvent("::load",{bubbles:!0}));let a=await fetch(t.dataset.include,{headers:{accept:"text/html,text/*"}});if(a.ok){let o=await a.text();t.dispatchEvent(new CustomEvent("::loaded",{bubbles:!0})),t.innerHTML=o;for(let s of t.childNodes)g(s,e);t.removeAttribute("data-include"),t.removeAttribute("data-lazy")}};t.hasAttribute("data-lazy")?x(t).then(n):n()}};var Y=new WeakSet,tt={select:"[data-for]",run:(t,e,r)=>{if(Y.has(t))return;let n=t.dataset.for.replace("let","").split("of"),a=n[0].split(","),o=n.at(-1).trim(),s=a[0].trim()==o?"__e":a[0].trim(),l=a[1]?.trim()??"__i",i=d(e,o),c=document.createComment(t.dataset.for);t.replaceWith(c),C.add(t);let u=()=>{let f=c;for(;(f=f.nextSibling)&&((f instanceof HTMLElement||f instanceof SVGElement)&&f.dataset.for==t.dataset.for);)f=f.previousSibling,f.nextSibling.remove()},b=f=>{if(u(),!f||!f[Symbol.iterator])return console.warn("data-for: The value given is not iterable.",{key:o,value:f});for(let y=0,z=c;y<f.length;y++){let V=t.cloneNode(!0),ht=Object.assign({},e,{[s]:f[y],[l]:y});Y.add(V),z.after(g(V,ht)),z=z.nextSibling}};b(p(i)),m(i)&&i.subscribe({next:b}),r()}};var et={select:"[data-if], [data-if-not]",run:(t,e)=>{let r=d(e,t.dataset.if||t.dataset.ifNot),n=document.createComment("if: "+(t.dataset.if||t.dataset.ifNot)),a=!!t.dataset.ifNot;t.replaceWith(n);let o=s=>{s=a?!s:s,!t.parentNode&&s?(t.hidden=!1,n.after(t)):t.localName!="link"&&t.remove()};o(p(r)),m(r)&&r.subscribe({next:o})}};var rt=new WeakSet,nt={select:"[data-lazy]",run:(t,e,r)=>{if(rt.has(t)||!t.childNodes.length)return;rt.add(t);let n=t.dataset.lazy,a=()=>{t.removeAttribute("data-lazy"),I(t,e);for(let o of t.childNodes)g(o,e)};n&&(t.addEventListener("::load",()=>t.classList.add(n),{once:!0}),t.addEventListener("::loaded",()=>t.classList.remove(n),{once:!0})),x(t).then(a),r()}};var at={select:"[data-on]",run:(t,e)=>{let r=n=>{let a=n.split(":"),o=a[0].trim(),s=a.at(-1).trim(),l=d(e,s);l&&t.addEventListener(o,l)};for(let n of t.dataset.on.split(","))r(n)}};var ot=t=>{let e=document.createElement("link");Object.assign(e,t),e.rel="preload",document.head.append(e)};var st=new WeakSet,it={select:"[data-preload]",run:t=>{if(st.has(t)||t.hidden)return;st.add(t);let e=()=>{let r=t.dataset.preload.split(",");for(let n of r){let a=n.split(":");ot({href:a[0],as:a[1]??"fetch"})}};t.hasAttribute("data-lazy")?x(t).then(e):e()}};var lt={select:"[data-route], [data-route-not]",run:async t=>{"URLPattern"in window||await import("https://kevinblt.github.io/hec/packages/@hec.js/ui/dist/urlpattnern.min.js");let e=t.dataset.route,r=document.createComment("route: "+e);Q({path:e,update:a=>{if(a){if(t.hidden=!1,t.parentNode)return;r.after(t)}else t.localName!="link"&&t.remove()},node:t}),t.replaceWith(r)}};var S="[data-component], [data-view], [data-page]";new MutationObserver(t=>{for(let e of t){for(let r of e.addedNodes){let n=r instanceof HTMLElement||r instanceof SVGElement;n&&!w.has(r)&&r.matches(S)?W(r,r.dataset.component??r.dataset.view??r.dataset.page):n&&w.has(r)&&r.dispatchEvent(new CustomEvent("::mount"))}for(let r of e.removedNodes)w.has(r)&&r.dispatchEvent(new CustomEvent("::unmount"))}}).observe(document,{childList:!0,subtree:!0});var M={},w=new WeakMap;function W(t,e){M[e]&&(M[e].use(t),w.set(t,M[e].component))}var _=class{constructor(e){Object.assign(this,e)}signals;node;props;#t=!1;#e=null;on(e,r,n=null){this.node.addEventListener(e,r,n)}emit(e,r=null,n=!1){this.node.dispatchEvent(new CustomEvent(e,{detail:r,bubbles:n}))}async insert(e){if(this.#e??=this.node.hasAttribute("data-lazy"),this.#e&&!this.#t)this.#t=!0,this.emit("::load",null,!0),this.node.removeAttribute("data-lazy"),await x(this.node);else{if(this.#t)return this.emit("::mount");await Promise.resolve(),this.emit("::load",null,!0),this.#t=!0}let r=e(this.signals,this);(a=>{P(this,E(a));let o=a instanceof Element&&a.querySelector("slot");if(o){let s=document.createComment("children");o.before(s),o.replaceWith(...this.node.childNodes)}this.node.append(a),this.emit("::loaded",null,!0);for(let s in this.props){let l=this.node.getAttribute(s)??"";this.node.hasAttribute(s)||this.node.setAttribute(s,this.props[s]?.toString()),l.startsWith("@")||this.signals[s].subscribe({next:i=>i==null?this.node.removeAttribute(s):this.node.setAttribute(s,i.toString())})}this.node.dispatchEvent(new CustomEvent("::mount"))})(r instanceof Promise?await r:r)}propSignalByLowerKey(e=""){e=e.toLowerCase();for(let r in this.signals)if(r.toLowerCase()==e)return[this.props[r],this.signals[r]];return[null,null]}attributeChange(e,r,n){let[a,o]=this.propSignalByLowerKey(e);if(n?.startsWith("@")){let s=this.node.parentNode,l=n.slice(1),i=d(E(s),l)??d(E(this.node),l);m(i)?this.signals[e]=i:o(i)}else o(typeof a=="number"?parseFloat(n):n)}};function ct(t,e,r){M[t]??={observer:new MutationObserver(a=>{for(let o of a)o.target instanceof Element&&w.get(o.target)?.attributeChange(o.attributeName,o.oldValue,o.target.getAttribute(o.attributeName))}),component:null,use(a){this.component=new _({signals:Object.fromEntries(Object.entries(e).map(o=>[o[0],h(o[1])])),props:e,node:a}),this.component.insert(r),this.observer.observe(a,{attributes:!0,attributeOldValue:!0,attributeFilter:Object.keys(e).map(o=>o.toLowerCase())})}};let n=S.replaceAll("]",`="${t}"]`);for(let a of document.querySelectorAll(n))W(a,t)}var pe=ct,de=ct;var ut={select:S,run:t=>{w.has(t)||W(t,t.dataset.component??t.dataset.view??t.dataset.page)}};var ft=[ut,tt,et,lt,it,X,at,D,J,nt];var mt={};function Te(t,e={}){t instanceof URL&&(t=t.host==location.host?t.pathname:t.toString());let r=document.querySelector(`template[name="${t}"]`);if(!r){let n=document.querySelector('head meta[name="template-path"]');return mt[t]??=new Promise(async a=>{r=document.createElement("template"),r.setAttribute("id",t.toString()),r.innerHTML=await fetch(n?.content?.replaceAll("[name]",t.toString())??t).then(o=>o.text()),document.body.append(r),a(r)}),mt[t].then(a=>g(a.content.cloneNode(!0),e))}return g(r.content.cloneNode(!0),e)}function Be(t,e={}){let r=document.createElement("template");return r.dataset.name="anonymous",r.innerHTML=t,g(r.content.cloneNode(!0),e)}function g(t,e={}){let r=(n,a=new WeakSet)=>{let o=!1;if(!(q(n)||a.has(n))){if(n.nodeName=="#document-fragment"&&P(n,e),n instanceof HTMLElement||n instanceof SVGElement){P(n,e);for(let s of ft)n.matches(s.select)&&s.run(n,e,()=>o=!0);if(o)return;I(n,e)}else if(n instanceof Text&&n.textContent.includes("{{")){let s=n.textContent.split(/{{|}}/g);for(let l=0,i=n,c;l<s.length;l++)c=document.createTextNode(s[l]),l%2!=0&&pt(`{{${s[l]}}}`,e,u=>c.data=u),a.add(c),i.after(c),i=c;n.remove()}a.add(n);for(let s of n.childNodes)r(s,a)}};return r(t,new WeakSet),t}var I=(t,e)=>{let r=t.getAttributeNames();for(let n of r){let a=t.getAttribute(n);a?.includes("{{")?pt(a,e,o=>{o=o.trim().replace(/ +/," "),o==="undefined"||o==="null"?t.removeAttribute(n):t.setAttribute(n,o)}):t.matches(S)&&F(e,a)&&t.setAttribute(n,`@${a}`)}},pt=(t,e,r)=>{let n=t.match(/{{[^}]+}}/g).map($),a=t,o=()=>{t=a;for(let s of n)t=t.replace(s.text,p(s.value));return t};for(let s of n){let l=null;if(s.prop[s.prop.length-1]===")"){let i=s.prop.split("("),c=d(e,i[1].substring(0,i[1].length-1).trim()),u=i[0].trim();l=d(e,u),l=l(),l.provide(p(c)),m(c)&&c.subscribe({next:b=>l.resolve(p(b))})}else l=d(e,s.prop);if(l==null&&console.warn(`{{ ${s.prop} }}: No value for this key`,{key:s.prop,value:l}),m(l)){let i=l;for(let c in s.meta)if(A[c]){let u=A[c];i=i.map(b=>u({value:b,key:s.prop,param:s.meta[c],options:s.meta}))}s.value=i,i.subscribe({next:()=>r(o())})}else{let i=l;for(let c in s.meta)if(A[c]){let u=A[c];i=u({value:p(l),key:s.prop,param:s.meta[c],options:s.meta})}s.value=()=>i}}r(o())};var dt=new WeakMap;function Ie(t,e=null){document.dispatchEvent(new CustomEvent(t,{detail:e}))}function _e(t,e){let r=n=>e(n.detail);dt.set(e,r),document.addEventListener(t,r)}function Ve(t){return new Promise(e=>{let r=n=>e(n.detail);document.addEventListener(t,r,{once:!0})})}function $e(t,e){document.removeEventListener(t,dt.get(e))}export{w as activeComponents,ct as component,S as componentSelector,Lt as deletePropsOf,bt as effect,Ie as emit,I as executeNodeAttributesTemplate,$ as expression,p as f,F as hasProp,q as hasProps,m as isSignal,Ct as memo,$e as off,_e as on,Ve as once,de as page,A as pipes,ft as plugins,d as prop,E as propsOf,Wt as provider,xt as resource,Mt as resourceBy,P as setPropsOf,h as signal,Te as templateByName,g as templateByNode,Be as templateByString,W as useComponent,pe as view};
