function U(t){let r=t.matchAll(/([^ {}\s]+)/g),n={meta:{},text:t,prop:null};for(let e of r)if(e[1].includes("=")){let o=e[1].split("=");n.meta[o[0]]=o[1].replaceAll(/'|"/g,"")}else n.prop=e[1];return n}var k={};var _=new WeakMap;function q(t,r=null){document.dispatchEvent(new CustomEvent(t,{detail:r}))}function V(t,r){let n=e=>r(e.detail);_.set(r,n),document.addEventListener(t,n)}function kt(t){return new Promise(r=>{let n=e=>r(e.detail);document.addEventListener(t,n,{once:!0})})}function Et(t,r){document.removeEventListener(t,_.get(r))}var $={items:new Map,setItem(t,r){this.items.set(t,r?.toString())},get length(){return this.items.keys().length},key(t){return Array.from(this.items.values()).at(t)},clear(){this.items.clear()},getItem(t){return this.items.get(t)},removeItem(t){this.items.delete(t)}},E=new Map;function ft(t){try{let r=window[t+"Storage"];return typeof r.length=="number"?r:$}catch{return $}}window.addEventListener("storage",t=>{if(!E.has(t.key))return;let r=E.get(t.key),n=t.storageArea.getItem(t.key);typeof n=="string"&&n!=="undefined"&&r.update(JSON.parse(n))});function g(t=null,r={}){if(r.id&&E.has(r.id))return E.get(r.id);let n=[],e=r.storage&&ft(r.storage),o=s=>{t=s,e&&e.setItem(r.id,JSON.stringify(t));for(let u of n)u.next(t)};function a(){return arguments.length&&t!==arguments[0]&&o(arguments[0]),t}let i=(s,u=null)=>{n.push(s),u?.signal.addEventListener("abort",()=>{let l=n.indexOf(s);l>-1&&n.splice(l,1)},{once:!0})};if(e){let s=e.getItem(r.id);o(typeof s=="string"&&s!=="undefined"?JSON.parse(s):t)}let c=Object.assign(a,{id:r.id,storage:r.storage,toString:()=>t?.toString(),set:s=>t=s,update:o,subscribe:i,map:s=>{let u=g(s(t)),l=new AbortController,f=u.subscribe;return i({next:m=>u(s(m))},{signal:l.signal}),Object.assign(u,{set:()=>null,subscribe:(m,p)=>{f(m,p),p?.signal.addEventListener("abort",()=>l.abort())}})},filter:s=>{let u=g(s(t)?t:null);return i({next:l=>s(l)?u(l):null}),Object.assign(u,{set:()=>null})}});return r.id&&E.set(r.id,c),c}function pt(t,r=[],n=null){for(let e of r)e.subscribe({next:()=>n=t(n)});return t(n)}function Mt(t,r=[],n=null){let e=g(null);return e(pt(o=>e(t(o)),r,n)),e}function dt(t,r=null){let n=g(r),e=g("loaded"),o=async()=>{if(e()!="pending"){try{e("pending"),n(await t()),e("loaded"),delete n.error}catch(a){e("error"),n.error=a}return n()}};return o(),Object.assign(n,{state:e,refetch:o})}function Ot(t,r,n=null){let e=dt(()=>r(h(t)),n);return d(t)&&t.subscribe({next:()=>e.refetch()}),e}function d(t){return t&&t.subscribe}function Wt(t,r=[]){function n(){let e=g(null),o=null,a=null,i=(c,s)=>{o=c,a=s,e(t(c,a))};for(let c of r)c.subscribe({next:()=>e(t(o,a))});return Object.assign(e,{provide:i})}return n}var h=t=>typeof t=="function"?h(t()):t;function x(t,r){let n=r?.split(".");if(!r)return t;if(!t)return null;for(let e of n){if(["state"].includes(e)&&t?.state)return t[e];if(d(t)){let o=t()?.[e];if(d(o)){let a=new AbortController,i=g(o());o.subscribe({next:i},{signal:a.signal});let c=s=>{a.abort(),d(s[e])?(a=new AbortController,s[e].subscribe({next:i},{signal:a.signal}),i(s[e]())):i(s[e])};t.subscribe({next:c}),t=i}else t=t.map(a=>a&&a[e])}else if(typeof t=="function")t=h(t);else if(typeof t[e]<"u")typeof t[e]=="function"&&!d(t[e])?t=t[e].bind(t):t=t[e];else return}return t}function Rt(t,r){let n=r.split(".");if(!r||!t)return!1;for(let e of n){if(["loading","error"].includes(e)&&t?.loading&&t?.error)return t[e];if(typeof t=="function")t=h(t);else if(typeof t[e]<"u")t=t[e];else return!1}return!0}var H="[data-component], [data-view], [data-page]",M=new Map,ht=t=>t!=null,w=new WeakMap,gt=new MutationObserver(t=>{for(let r of t)w.has(r.target)&&w.get(r.target)(r.attributeName)});function F(t,r,n){M.set(t,async(e,o)=>{let a={},i=Array.from(e.childNodes),c=(l,f)=>({number:parseFloat,boolean:p=>p===!0||p==="true"})[typeof r[l]]?.(f)??f,s=l=>{let f=e.getAttribute(l);for(let m in a)m.toLowerCase()==l&&a[m](c(m,f))};for(let l in r){let f=e.getAttribute(l)??r[l];if(typeof f=="string"&&f.startsWith("@")){let m=x(o,f.substring(1));a[l]=d(m)?m:g(m)}else a[l]=g(c(l,f)),a[l].subscribe({next:m=>ht(m)?e.setAttribute(l,m):e.removeAttribute(l)})}gt.observe(e,{attributeFilter:Object.keys(r).map(l=>l.toLowerCase())}),w.set(e,s);let u=n(a,e);if(u instanceof Promise&&(u=await u),e.append(u),i.length){let l=e.querySelector("slot"),f=document.createComment("children/"),m=document.createComment("/children");if(l){for(let p of i)p instanceof Element&&l.getAttributeNames().forEach(v=>p.setAttribute(v,l.getAttribute(v)));l.replaceWith(f,...i,m)}else e.append(f,...i);for(let p of i)b(p,Object.assign({},o,T.get(u)))}e.dispatchEvent(new CustomEvent("::mount"))}),q("::component/"+t)}var _t=F,qt=F;var L=new WeakMap,P=new WeakMap,Q=new IntersectionObserver(t=>{for(let r of t)if(r.isIntersecting&&L.has(r.target))for(let n of L.get(r.target))n(),L.delete(r.target),Q.unobserve(r.target)},{rootMargin:"256px"});new MutationObserver(t=>{for(let r of t){let n=o=>{for(let a of o){if(w.has(a)&&a.dispatchEvent(new CustomEvent("::mount")),P.has(a)){let i=P.get(a);for(;i.length;)i.shift()();P.delete(a)}n(a.childNodes)}},e=o=>{for(let a of o)w.has(a)&&a.dispatchEvent(new CustomEvent("::unmount")),e(a.childNodes)};n(r.addedNodes),e(r.removedNodes)}}).observe(document,{childList:!0,subtree:!0});function A(t){return new Promise(r=>{let n=L.get(t)??[];n.push(r),L.set(t,n),Q.observe(t)})}function O(t){return new Promise(r=>{let n=P.get(t)??[];t.getRootNode()==document&&queueMicrotask(()=>r()),n.push(r),P.set(t,n)})}var bt=g({}),W=g(location.pathname),J=window.history.pushState,xt=window.history.replaceState,B={updateQueued:!1},C=document.querySelector('head meta[name="route"]')||document.createElement("meta");C.name="route";C.content=location.pathname;document.head.append(C);var D=[],G=new WeakMap;function yt(t,r){let n=Array.from(t.path.matchAll(/\:/g)).length*25,e=Array.from(r.path.matchAll(/\:/g)).length*25;return n+=Array.from(t.path.matchAll(/\*/g)).length*150,e+=Array.from(r.path.matchAll(/\*/g)).length*150,n-e}function Gt(t=""){window.history.pushState(null,null,t)}function j(t){let r=t.node,n=t.path,e=t.placeholder,o=r.parentElement??e?.parentElement,a=o?.closest("[data-route]"),i=G.get(a),c=i?.pattern?.pathname,s=i?.group??D;if(o?.getRootNode()!==document)return O(e).then(()=>j(t));t.group=[],G.set(r,t),c&&(n=n=="/"?"":n,n=c.replaceAll(/[^\/a-zA-Z0-9]+$/gm,"")+n.replaceAll(/^[^\/a-zA-Z0-9]+/gm,"")),n=n.replaceAll(/\/+/g,"/").replace(/\/$/m,""),t.pattern=new URLPattern({pathname:n||"/"}),s.push(t),s.sort(yt),B.updateQueued||(B.updateQueued=!0,queueMicrotask(y))}function y(t=location.href){t=new URL(t.replace(/index\.*[a-z0-9]*$/gm,""),location.href).toString();let r=!1,n=e=>{let o=!1;for(let a of e){let i=a.pattern.test(t);a.update(!o&&i),!o&&i?(o=!0,a.node.classList.add("--active"),a.group.length?n(a.group):(r=!0,C.content=a.pattern.pathname)):(a.node.classList.remove("--active"),a.node.className||a.node.removeAttribute("class"))}return r};return B.updateQueued=!1,n(D)?(W(t),bt(Object.fromEntries(new URLSearchParams(location.search)))):y(W()),r}var vt=t=>{let r=t.target.closest("a"),n=r?.href,e=new URL(n,location.href);n&&!r.hasAttribute("download")&&e.hostname==location.hostname&&y(n)&&(J.call(window.history,null,null,n),t.preventDefault())};window.addEventListener("popstate",()=>y());window.addEventListener("hashchange",()=>y());window.addEventListener("click",vt);window.history.pushState=function(r,n,e){J.call(window.history,r,n,e),y(e.toString())};window.history.replaceState=function(r,n,e){xt.call(window.history,r,n,e),y(e.toString())};var Z={select:t=>t.matches("[data-if], [data-if-not]"),run:(t,r)=>{let n=t.dataset.if||t.dataset.ifNot,e=!!t.dataset.ifNot,o=document.createComment((e?"if not:":"if: ")+n),a=I(t,o,r,e);t.replaceWith(o),t.removeAttribute("data-group"),N(n,r,a,!1)}};function wt(t,r){if("group"in t.dataset&&t instanceof HTMLTemplateElement){let n=Array.from(t.content.childNodes);for(let e of n)b(e,r);return n}return[t]}function I(t,r,n,e=!1){let o=wt(t,n),a=!!t.closest("head");return i=>{if(i=e?!i:i,!t.parentNode&&i)t.hidden=!1,r.replaceWith(...o);else if(!r.parentNode&&!i&&!a)for(let c of o)c.replaceWith(r)}}var K={select:t=>t.matches("[data-route]"),run:async(t,r)=>{"URLPattern"in window||await import("https://kevinblt.github.io/hec/packages/@hec.js/ui/dist/urlpattnern.min.js");let n=t.dataset.route,e=document.createComment("route: "+n),o=I(t,e,r);j({path:n,update:o,node:t,placeholder:e}),t.removeAttribute("data-group"),t.replaceWith(e)}},X={select:t=>t.matches("[data-match], [href]"),run:t=>{if(!t.parentNode||t.hasAttribute("download"))return;let r=t.dataset.match??"--active",n=a=>a.replace(/index\.*[a-z0-9]*$/gm,"");function e(a){return n(new URL(a,location.href).pathname)}let o=a=>{e(t.getAttribute("href"))==e(a)?t.classList.add(r):(t.classList.remove(r),t.className||t.removeAttribute("class"))};W.subscribe({next:o}),queueMicrotask(()=>o(location.pathname)),t.removeAttribute("data-match")}};var Y={number:t=>t.valueAsNumber,date:t=>t.valueAsDate,text:t=>t.value,checkbox:t=>t.checked,"":t=>t.value},tt={select:t=>t.matches("[data-bind]"),run:(t,r)=>{let n=t.dataset.bind||t.getAttribute("name"),e=x(r,n);if(e){let o=a=>{t.type=="checkbox"?t.checked=a:t.value=a};o(h(e)),d(e)&&(e.subscribe({next:o}),t.addEventListener("input",()=>e(Y[t.type]?.(t)??t.value)),t.addEventListener("change",()=>e(Y[t.type]?.(t)??t.value)))}}};var S=new WeakSet,et={select:t=>t.matches("[data-lazy]"),run:(t,r,n)=>{if(S.has(t))return;S.add(t);let e=()=>{t.removeAttribute("data-lazy");for(let o of t.childNodes)b(o,r)};A(t).then(e),n()}};var z=new WeakSet,rt={select:t=>t.matches("[data-include]"),run:(t,r)=>{if(z.has(t)||t.children.length)return;z.add(t);let n=async()=>{t.dispatchEvent(new CustomEvent("::load",{bubbles:!0})),t.setAttribute("data-loading",t.dataset.include);let e=await fetch(t.dataset.include,{headers:{accept:"text/html,text/*"}});if(e.ok){let o=await e.text(),a=document.createElement("div");t.dispatchEvent(new CustomEvent("::loaded",{bubbles:!0})),a.innerHTML=o;for(let i of a.childNodes)b(i,r);"group"in t.dataset?t.replaceWith(...a.childNodes):t.append(...a.childNodes),t.removeAttribute("data-include"),t.removeAttribute("data-lazy"),t.removeAttribute("data-group"),t.removeAttribute("data-loading"),t.className||t.removeAttribute("class")}};t.hasAttribute("data-lazy")?(S.add(t),A(t).then(n)):n()}};var nt=new WeakSet,at={select:t=>t.matches("[data-for]"),run:(t,r,n)=>{if(nt.has(t))return;let e=t.dataset.for.replace("let","").split("of"),o=e[0].split(","),a=e.at(-1).trim(),i=o[0].trim()==a?"__e":o[0].trim(),c=o[1]?.trim()??"__i",s=x(r,a),u=document.createComment(t.dataset.for);t.replaceWith(u),z.add(t);let l=()=>{let m=u;for(;(m=m.nextSibling)&&((m instanceof HTMLElement||m instanceof SVGElement)&&m.dataset.for==t.dataset.for);)m=m.previousSibling,m.nextSibling.remove()},f=m=>{if(l(),!m||!m[Symbol.iterator])return console.warn("data-for: The value given is not iterable.",{key:a,value:m});for(let p=0,v=u;p<m.length;p++){let R=t.cloneNode(!0),mt=Object.assign({},r,{[i]:m[p],[c]:p});nt.add(R),v.after(R),b(R,mt),v=v.nextSibling}};queueMicrotask(()=>f(h(s))),d(s)&&s.subscribe({next:f}),n()}};var ot={select:t=>Object.keys(t.dataset).some(r=>r.startsWith("on.")),run:(t,r)=>{for(let n in t.dataset)if(n.startsWith("on.")){let e=t.dataset[n];t.removeAttribute(n),t.addEventListener(n.split(".")[1],x(r,e))}}};var st=new WeakSet,it={select:t=>t.matches(H),run:(t,r,n)=>{let e=t.dataset.component??t.dataset.view??t.dataset.page;if(st.has(t)||!t.parentNode)return;st.add(t);let o=async()=>{if(!M.has(e))return V("::component/"+e,o);t.removeAttribute("data-lazy"),t.setAttribute("data-loading",e),await M.get(e)(t,r),t.removeAttribute("data-loading")};t.hasAttribute("data-lazy")?(S.add(t),A(t).then(o)):O(t).then(o),n()}};var ct={select:t=>Object.keys(t.dataset).some(r=>r.startsWith("class.")),run:(t,r)=>{if(!t.parentNode)return;let n=(e,o)=>{e?t.classList.add(o):(t.classList.remove(o),t.className||t.removeAttribute("class"))};for(let e of t.getAttributeNames())if(e.startsWith("data-class.")){let o=e.split(".")[1],a=t.getAttribute(e);t.removeAttribute(e),N(a,r,i=>n(i,o),!1)}}};var lt=[at,it,Z,K,rt,ot,ct,tt,X,et];var ut={},T=new WeakMap;function _e(t,r={}){t instanceof URL&&(t=t.host==location.host?t.pathname:t.toString());let n=document.querySelector(`template[name="${t}"]`);if(!n){let e=document.querySelector('head meta[name="template-path"]');return ut[t]??=new Promise(async o=>{n=document.createElement("template"),n.setAttribute("id",t.toString()),n.innerHTML=await fetch(e?.content?.replaceAll("[name]",t.toString())??t).then(a=>a.text()),document.body.append(n),o(n)}),ut[t].then(o=>b(o.content.cloneNode(!0),r))}return b(n.content.cloneNode(!0),r)}function qe(t,r={}){let n=document.createElement("template");return n.innerHTML=t,b(n.content.cloneNode(!0),r)}function b(t,r={}){T.set(t,r);let n=(e,o=new WeakSet)=>{let a=!1;if(!o.has(e)){if(e instanceof HTMLElement||e instanceof SVGElement){for(let i of lt)i.select(e)&&i.run(e,r,()=>a=!0);if((e.parentNode||!e.dataset.for)&&At(e,r),a)return}else if(e instanceof Text&&e.textContent.includes("{{")){let i=e.textContent.split(/{{|}}/g);for(let c=0,s=e,u;c<i.length;c++)u=document.createTextNode(i[c]),c%2!=0&&N(`{{${i[c]}}}`,r,l=>u.data=l),o.add(u),s.after(u),s=u;e.remove()}o.add(e);for(let i of e.childNodes)n(i,o)}};return n(t,new WeakSet),t}var At=(t,r)=>{let n=t.getAttributeNames();for(let e of n){let o=t.getAttribute(e);o?.includes("{{")&&N(o,r,a=>{a=a.replace(/ +/," ").trim(),a==="undefined"||a==="null"?t.removeAttribute(e):t.setAttribute(e,a)})}},N=(t,r,n,e=!0)=>{let o=t.match(/{{[^}]+}}/g)?.map(U)??[],a=t;!e&&!o.length&&(o=[{prop:t,meta:{}}]);let i=()=>{t=a;for(let c of o)t=t.replace(c.text,h(c.value));return t};for(let c of o){let s=null;if(c.prop?.[c.prop.length-1]===")"){let u=c.prop.split("("),l=x(r,u[1].substring(0,u[1].length-1).trim()),f=u[0].trim();s=x(r,f),s=s(),s.provide(h(l),c.meta),d(l)&&l.subscribe({next:m=>s.provide(h(m),c.meta)})}else s=x(r,c.prop);if(s==null&&!Object.keys(c.meta).length&&console.warn(`{{ ${c.prop} }}: No value for this key`,{key:c.prop,value:s}),d(s)){let u=s;for(let l in c.meta)if(k[l]){let f=k[l];u=u.map(m=>f({value:m,key:c.prop,param:c.meta[l],options:c.meta}))}c.value=u,u.subscribe({next:l=>n(e?i():l)}),!e&&s.update(h(s))}else{let u=s;for(let l in c.meta)if(k[l]){let f=k[l];u=f({value:h(s),key:c.prop,param:c.meta[l],options:c.meta})}c.value=()=>u,!e&&n(u)}}e&&n(i())};var $e=t=>{let r=document.head.querySelector(`link[rel="preload"][href="${t.href}"]`)??document.createElement("link");Object.assign(r,t),r.rel="preload",document.head.append(r)};export{j as addRoute,N as bindExpressions,F as component,H as componentSelector,w as componentUpdate,M as components,pt as effect,q as emit,At as executeNodeAttributesTemplate,U as expression,h as f,Rt as hasProp,d as isSignal,ht as isValue,Mt as memo,Gt as navigate,T as nodeProps,Et as off,V as on,kt as once,qt as page,k as pipes,lt as plugins,$e as preload,x as prop,Wt as provider,bt as query,dt as resource,Ot as resourceBy,W as route,g as signal,_e as templateByName,b as templateByNode,qe as templateByString,_t as view};
